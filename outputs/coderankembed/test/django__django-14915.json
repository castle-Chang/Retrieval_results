{
  "instance_id": "django__django-14915",
  "query": "ModelChoiceIteratorValue is not hashable.\nDescription\n\t\nRecently I migrated from Django 3.0 to Django 3.1. In my code, I add custom data-* attributes to the select widget options. After the upgrade some of those options broke. Error is {TypeError}unhashable type: 'ModelChoiceIteratorValue'.\nExample (this one breaks):\n\tdef create_option(self, name, value, label, selected, index, subindex=None, attrs=None):\n\t\tcontext = super().create_option(name, value, label, selected, index, subindex, attrs)\n\t\tif not value:\n\t\t\treturn context\n\t\tif value in self.show_fields: # This is a dict {1: ['first_name', 'last_name']}\n\t\t\tcontext['attrs']['data-fields'] = json.dumps(self.show_fields[value])\nHowever, working with arrays is not an issue:\n\tdef create_option(self, name, value, label, selected, index, subindex=None, attrs=None):\n\t\tcontext = super().create_option(name, value, label, selected, index, subindex, attrs)\n\t\tif not value:\n\t\t\treturn context\n\t\tif value in allowed_values: # This is an array [1, 2]\n\t\t\t...\n",
  "ground_truth": {
    "files": [
      "django/forms/models.py"
    ],
    "locations": [
      "django/forms/models.py::ModelChoiceIteratorValue",
      "django/forms/models.py::ModelChoiceIteratorValue.__str__",
      "django/forms/models.py::ModelChoiceIteratorValue.__eq__"
    ]
  },
  "predictions": [
    "django/forms/models.py::ModelChoiceIteratorValue.__str__",
    "django/forms/models.py::ModelMultipleChoiceField.prepare_value",
    "tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_choice_iterator_passes_model_to_widget",
    "tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_custom_choice_iterator_passes_model_to_widget",
    "django/forms/models.py::ModelChoiceIteratorValue.__init__",
    "django/forms/models.py::ModelChoiceField.prepare_value",
    "django/forms/widgets.py::ChoiceWidget.create_option",
    "django/forms/widgets.py::Select.get_context",
    "django/forms/models.py::ModelChoiceIterator.choice",
    "django/contrib/admin/widgets.py::FilteredSelectMultiple.get_context"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "903aaa35e5ceaa33bfc9b19b7f6da65ce5a91dd4",
    "total_functions_indexed": 25127,
    "retrieval_time_seconds": 0.09580230712890625
  },
  "raw_output": "[{\"doc_id\": \"django/forms/models.py::ModelChoiceIteratorValue.__str__\", \"score\": 0.5243366956710815}, {\"doc_id\": \"django/forms/models.py::ModelMultipleChoiceField.prepare_value\", \"score\": 0.518627941608429}, {\"doc_id\": \"tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_choice_iterator_passes_model_to_widget\", \"score\": 0.5090747475624084}, {\"doc_id\": \"tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_custom_choice_iterator_passes_model_to_widget\", \"score\": 0.5082165002822876}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIteratorValue.__init__\", \"score\": 0.4797428846359253}, {\"doc_id\": \"django/forms/models.py::ModelChoiceField.prepare_value\", \"score\": 0.4734336733818054}, {\"doc_id\": \"django/forms/widgets.py::ChoiceWidget.create_option\", \"score\": 0.46968701481819153}, {\"doc_id\": \"django/forms/widgets.py::Select.get_context\", \"score\": 0.460757851600647}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIterator.choice\", \"score\": 0.4603579640388489}, {\"doc_id\": \"django/contrib/admin/widgets.py::FilteredSelectMultiple.get_context\", \"score\": 0.45062142610549927}]"
}