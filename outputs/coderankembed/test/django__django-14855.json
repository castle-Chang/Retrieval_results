{
  "instance_id": "django__django-14855",
  "query": "Wrong URL generated by get_admin_url for readonly field in custom Admin Site\nDescription\n\t\nWhen a model containing a ForeignKey field is viewed (or edited) in a custom Admin Site, and that ForeignKey field is listed in readonly_fields, the url generated for the link is /admin/... instead of /custom-admin/....\nThis appears to be caused by the following line in django.contrib.admin.helpers get_admin_url:\nurl = reverse(url_name, args=[quote(remote_obj.pk)])\nOther parts of the admin use the current_app keyword parameter to identify the correct current name of the Admin Site. (See django.contrib.admin.options.ModelAdmin response_add as just one example)\nI have been able to correct this specific issue by replacing the above line with:\nurl = reverse(\n\turl_name,\n\targs=[quote(remote_obj.pk)],\n\tcurrent_app=self.model_admin.admin_site.name\n)\nHowever, I don't know if there are any side effects and I have not yet run the full suite of tests on this. Mostly looking for feedback whether I'm on the right track.\n",
  "ground_truth": {
    "files": [
      "django/contrib/admin/helpers.py"
    ],
    "locations": [
      "django/contrib/admin/helpers.py::AdminReadonlyField",
      "django/contrib/admin/helpers.py::AdminReadonlyField.get_admin_url"
    ]
  },
  "predictions": [
    "django/contrib/admin/helpers.py::AdminReadonlyField.get_admin_url",
    "tests/admin_views/tests.py::ReadonlyTest.test_readonly_foreignkey_links",
    "tests/admin_custom_urls/tests.py::AdminCustomUrlsTest.test_admin_URLs_no_clash",
    "django/contrib/admin/widgets.py::RelatedFieldWidgetWrapper.get_related_url",
    "django/contrib/admin/widgets.py::ForeignKeyRawIdWidget.label_and_url_for_value",
    "tests/admin_views/tests.py::ReadonlyTest.test_readonly_onetoone_backwards_ref",
    "tests/admin_views/tests.py::CustomModelAdminTest.test_custom_admin_site_view",
    "tests/admin_widgets/tests.py::ForeignKeyRawIdWidgetTest.test_fk_to_self_model_not_in_admin",
    "tests/admin_custom_urls/models.py::ActionAdmin.get_urls",
    "tests/modeladmin/tests.py::ModelAdminTests.test_custom_formfield_override_readonly"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "475cffd1d64c690cdad16ede4d5e81985738ceb4",
    "total_functions_indexed": 25127,
    "retrieval_time_seconds": 0.06983184814453125
  },
  "raw_output": "[{\"doc_id\": \"django/contrib/admin/helpers.py::AdminReadonlyField.get_admin_url\", \"score\": 0.6253286004066467}, {\"doc_id\": \"tests/admin_views/tests.py::ReadonlyTest.test_readonly_foreignkey_links\", \"score\": 0.5563965439796448}, {\"doc_id\": \"tests/admin_custom_urls/tests.py::AdminCustomUrlsTest.test_admin_URLs_no_clash\", \"score\": 0.4940778911113739}, {\"doc_id\": \"django/contrib/admin/widgets.py::RelatedFieldWidgetWrapper.get_related_url\", \"score\": 0.4862877130508423}, {\"doc_id\": \"django/contrib/admin/widgets.py::ForeignKeyRawIdWidget.label_and_url_for_value\", \"score\": 0.47407811880111694}, {\"doc_id\": \"tests/admin_views/tests.py::ReadonlyTest.test_readonly_onetoone_backwards_ref\", \"score\": 0.4633096158504486}, {\"doc_id\": \"tests/admin_views/tests.py::CustomModelAdminTest.test_custom_admin_site_view\", \"score\": 0.4597916603088379}, {\"doc_id\": \"tests/admin_widgets/tests.py::ForeignKeyRawIdWidgetTest.test_fk_to_self_model_not_in_admin\", \"score\": 0.4529394507408142}, {\"doc_id\": \"tests/admin_custom_urls/models.py::ActionAdmin.get_urls\", \"score\": 0.45220130681991577}, {\"doc_id\": \"tests/modeladmin/tests.py::ModelAdminTests.test_custom_formfield_override_readonly\", \"score\": 0.4518563747406006}]"
}