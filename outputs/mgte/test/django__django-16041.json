{
  "instance_id": "django__django-16041",
  "query": "Rendering empty_form crashes when empty_permitted is passed to form_kwargs\nDescription\n\t\nIssue\nWhen explicitly setting form_kwargs = {'empty_permitted':True} or form_kwargs = {'empty_permitted':False} , a KeyError occurs when rendering a template that uses a formset's empty_form.\nExpected Behavior\nempty_permitted is ignored for formset.empty_form since empty_permitted is irrelevant for empty_form, as empty_form is not meant to be used to pass data and therefore does not need to be validated.\nSteps to Reproduce\n# views.py\nfrom django.shortcuts import render\nfrom .models import MyModel\ndef test_view(request):\n\tcontext = {}\n\tff = modelformset_factory(MyModel, fields = ['a_field'])\n\tcontext['formset'] = ff(\n\t\tqueryset = MyModel.objects.none(),\n\t\tform_kwargs = {'empty_permitted':True} # or form_kwargs = {'empty_permitted':False}\n\t)\n\treturn render(request, 'my_app/my_model_formset.html', context)\n# urls.py\nfrom django.urls import path, include\nfrom .views import test_view\nurlpatterns = [\n\tpath('test', test_view)\n]\n# my_model_formset.html\n{% extends \"my_app/base.html\" %}\n{% block content %}\n<form id=\"my-form\" method=\"post\">\n {% csrf_token %}\n {{ formset }}\n <input type=\"submit\" value=\"Save\">\n</form>\n{{ formset.empty_form }}\n{% endblock %}\n",
  "ground_truth": {
    "files": [
      "django/forms/formsets.py"
    ],
    "locations": [
      "django/forms/formsets.py::BaseFormSet",
      "django/forms/formsets.py::BaseFormSet.empty_form"
    ]
  },
  "predictions": [
    "tests/forms_tests/tests/test_forms.py::FormsTestCase.test_empty_permitted",
    "django/forms/formsets.py::BaseFormSet.empty_form",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form",
    "tests/forms_tests/tests/test_formsets.py::TestEmptyFormSet.test_empty_formset_is_valid",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_validation_with_child_model_without_id",
    "tests/forms_tests/tests/test_formsets.py::TestIsBoundBehavior.test_no_data_error",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_displaying_more_than_one_blank_form",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_simple_save",
    "tests/model_formsets_regress/tests.py::InlineFormsetTests.test_empty_fields_on_modelformset",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_validation_without_id"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "6df9398cce063874ae4d59db126d4adacb0fa8d3",
    "total_functions_indexed": 26156,
    "retrieval_time_seconds": 0.10229229927062988
  },
  "raw_output": "[{\"doc_id\": \"tests/forms_tests/tests/test_forms.py::FormsTestCase.test_empty_permitted\", \"score\": 0.8022160530090332}, {\"doc_id\": \"django/forms/formsets.py::BaseFormSet.empty_form\", \"score\": 0.7990403175354004}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form\", \"score\": 0.7792266011238098}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::TestEmptyFormSet.test_empty_formset_is_valid\", \"score\": 0.7546870112419128}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_validation_with_child_model_without_id\", \"score\": 0.749886155128479}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::TestIsBoundBehavior.test_no_data_error\", \"score\": 0.7497183680534363}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_displaying_more_than_one_blank_form\", \"score\": 0.7496447563171387}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_simple_save\", \"score\": 0.7480307817459106}, {\"doc_id\": \"tests/model_formsets_regress/tests.py::InlineFormsetTests.test_empty_fields_on_modelformset\", \"score\": 0.7462458610534668}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_validation_without_id\", \"score\": 0.7437900900840759}]"
}