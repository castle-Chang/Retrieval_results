{
  "instance_id": "sympy__sympy-18057",
  "query": "Sympy incorrectly attempts to eval reprs in its __eq__ method\nPassing strings produced by unknown objects into eval is **very bad**. It is especially surprising for an equality check to trigger that kind of behavior. This should be fixed ASAP.\r\n\r\nRepro code:\r\n\r\n```\r\nimport sympy\r\nclass C:\r\n    def __repr__(self):\r\n        return 'x.y'\r\n_ = sympy.Symbol('x') == C()\r\n```\r\n\r\nResults in:\r\n\r\n```\r\nE   AttributeError: 'Symbol' object has no attribute 'y'\r\n```\r\n\r\nOn the line:\r\n\r\n```\r\n    expr = eval(\r\n        code, global_dict, local_dict)  # take local objects in preference\r\n```\r\n\r\nWhere code is:\r\n\r\n```\r\nSymbol ('x' ).y\r\n```\r\n\r\nFull trace:\r\n\r\n```\r\nFAILED                   [100%]\r\n        class C:\r\n            def __repr__(self):\r\n                return 'x.y'\r\n    \r\n>       _ = sympy.Symbol('x') == C()\r\n\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nsympy/core/expr.py:124: in __eq__\r\n    other = sympify(other)\r\nsympy/core/sympify.py:385: in sympify\r\n    expr = parse_expr(a, local_dict=locals, transformations=transformations, evaluate=evaluate)\r\nsympy/parsing/sympy_parser.py:1011: in parse_expr\r\n    return eval_expr(code, local_dict, global_dict)\r\nsympy/parsing/sympy_parser.py:906: in eval_expr\r\n    code, global_dict, local_dict)  # take local objects in preference\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\n>   ???\r\nE   AttributeError: 'Symbol' object has no attribute 'y'\r\n\r\n<string>:1: AttributeError\r\n```\r\n\r\nRelated issue: an unknown object whose repr is `x` will incorrectly compare as equal to a sympy symbol x:\r\n\r\n```\r\n    class C:\r\n        def __repr__(self):\r\n            return 'x'\r\n\r\n    assert sympy.Symbol('x') != C()  # fails\r\n```\n",
  "ground_truth": {
    "files": [
      "sympy/core/expr.py"
    ],
    "locations": [
      "sympy/core/expr.py::Expr",
      "sympy/core/expr.py::Expr.__eq__"
    ]
  },
  "predictions": [
    "sympy/core/expr.py::Expr.equals",
    "sympy/core/containers.py::Tuple._eval_Eq",
    "sympy/parsing/ast_parser.py::parse_expr",
    "sympy/external/tests/test_sage.py::check_expression",
    "sympy/core/basic.py::Basic.dummy_eq",
    "sympy/parsing/sympy_parser.py::eval_expr",
    "sympy/core/tests/test_symbol.py::test_symbols",
    "sympy/core/numbers.py::NaN._eval_Eq",
    "sympy/core/function.py::Derivative.__new__",
    "sympy/parsing/sympy_parser.py::evaluateFalse"
  ],
  "metadata": {
    "repo": "sympy/sympy",
    "commit": "62000f37b8821573ba00280524ffb4ac4a380875",
    "total_functions_indexed": 33599,
    "retrieval_time_seconds": 0.010959148406982422
  },
  "raw_output": "[{\"doc_id\": \"sympy/core/expr.py::Expr.equals\", \"score\": 0.7723701000213623}, {\"doc_id\": \"sympy/core/containers.py::Tuple._eval_Eq\", \"score\": 0.7632034420967102}, {\"doc_id\": \"sympy/parsing/ast_parser.py::parse_expr\", \"score\": 0.7603112459182739}, {\"doc_id\": \"sympy/external/tests/test_sage.py::check_expression\", \"score\": 0.7547429203987122}, {\"doc_id\": \"sympy/core/basic.py::Basic.dummy_eq\", \"score\": 0.7530484795570374}, {\"doc_id\": \"sympy/parsing/sympy_parser.py::eval_expr\", \"score\": 0.7521216869354248}, {\"doc_id\": \"sympy/core/tests/test_symbol.py::test_symbols\", \"score\": 0.7506452202796936}, {\"doc_id\": \"sympy/core/numbers.py::NaN._eval_Eq\", \"score\": 0.748955488204956}, {\"doc_id\": \"sympy/core/function.py::Derivative.__new__\", \"score\": 0.7489107847213745}, {\"doc_id\": \"sympy/parsing/sympy_parser.py::evaluateFalse\", \"score\": 0.7482339143753052}]"
}