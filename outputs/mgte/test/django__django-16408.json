{
  "instance_id": "django__django-16408",
  "query": "Multi-level FilteredRelation with select_related() may set wrong related object.\nDescription\n\t\ntest case:\n# add to known_related_objects.tests.ExistingRelatedInstancesTests\n\tdef test_wrong_select_related(self):\n\t\twith self.assertNumQueries(3):\n\t\t\tp = list(PoolStyle.objects.annotate(\n\t\t\t\ttournament_pool=FilteredRelation('pool__tournament__pool'),\n\t\t\t\t).select_related('tournament_pool'))\n\t\t\tself.assertEqual(p[0].pool.tournament, p[0].tournament_pool.tournament)\nresult:\n======================================================================\nFAIL: test_wrong_select_related (known_related_objects.tests.ExistingRelatedInstancesTests.test_wrong_select_related)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n File \"D:\\Work\\django\\tests\\known_related_objects\\tests.py\", line 171, in test_wrong_select_related\n\tself.assertEqual(p[0].pool.tournament, p[0].tournament_pool.tournament)\nAssertionError: <Tournament: Tournament object (1)> != <PoolStyle: PoolStyle object (1)>\n----------------------------------------------------------------------\n",
  "ground_truth": {
    "files": [
      "django/db/models/sql/compiler.py"
    ],
    "locations": [
      "django/db/models/sql/compiler.py::SQLCompiler",
      "django/db/models/sql/compiler.py::SQLCompiler.get_related_selections"
    ]
  },
  "predictions": [
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_one_to_one_multi_select_related",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_one_to_one_select_related",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_one_to_one_multi_select_related",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_fk_select_related_multiple",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_queryset_or",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_one_to_one_select_related",
    "tests/filtered_relation/tests.py::FilteredRelationTests.test_select_related_multiple",
    "tests/filtered_relation/tests.py::FilteredRelationTests.test_select_related",
    "tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_queryset_and",
    "tests/many_to_one/tests.py::ManyToOneTests.test_select_related"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "ef85b6bf0bc5a8b194f0724cf5bbedbcee402b96",
    "total_functions_indexed": 26331,
    "retrieval_time_seconds": 0.06793642044067383
  },
  "raw_output": "[{\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_one_to_one_multi_select_related\", \"score\": 0.854218602180481}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_one_to_one_select_related\", \"score\": 0.8405855298042297}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_one_to_one_multi_select_related\", \"score\": 0.8362481594085693}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_fk_select_related_multiple\", \"score\": 0.8327047824859619}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_queryset_or\", \"score\": 0.825598955154419}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_reverse_one_to_one_select_related\", \"score\": 0.8248623609542847}, {\"doc_id\": \"tests/filtered_relation/tests.py::FilteredRelationTests.test_select_related_multiple\", \"score\": 0.81513512134552}, {\"doc_id\": \"tests/filtered_relation/tests.py::FilteredRelationTests.test_select_related\", \"score\": 0.8121105432510376}, {\"doc_id\": \"tests/known_related_objects/tests.py::ExistingRelatedInstancesTests.test_queryset_and\", \"score\": 0.8120466470718384}, {\"doc_id\": \"tests/many_to_one/tests.py::ManyToOneTests.test_select_related\", \"score\": 0.8116165995597839}]"
}