{
  "instance_id": "django__django-16873",
  "query": "Template filter `join` should not escape the joining string if `autoescape` is `off`\nDescription\n\t\nConsider the following template code snippet:\n{% autoescape off %}\n{{ some_list|join:some_var }}\n{% endautoescape %}\nin this case, the items inside some_list will not be escaped (matching the expected behavior) but some_var will forcibly be escaped. From the docs for autoescape or join I don't think this is expected behavior.\nThe following testcase illustrates what I think is a bug in the join filter (run inside the template_tests/filter_tests folder):\nfrom django.template.defaultfilters import escape\nfrom django.test import SimpleTestCase\nfrom ..utils import setup\nclass RegressionTests(SimpleTestCase):\n\t@setup({\"join01\": '{{ some_list|join:some_var }}'})\n\tdef test_join01(self):\n\t\tsome_list = [\"<p>Hello World!</p>\", \"beta & me\", \"<script>Hi!</script>\"]\n\t\tsome_var = \"<br/>\"\n\t\toutput = self.engine.render_to_string(\"join01\", {\"some_list\": some_list, \"some_var\": some_var})\n\t\tself.assertEqual(output, escape(some_var.join(some_list)))\n\t@setup({\"join02\": '{% autoescape off %}{{ some_list|join:some_var }}{% endautoescape %}'})\n\tdef test_join02(self):\n\t\tsome_list = [\"<p>Hello World!</p>\", \"beta & me\", \"<script>Hi!</script>\"]\n\t\tsome_var = \"<br/>\"\n\t\toutput = self.engine.render_to_string(\"join02\", {\"some_list\": some_list, \"some_var\": some_var})\n\t\tself.assertEqual(output, some_var.join(some_list))\nResult of this run in current main is:\n.F\n======================================================================\nFAIL: test_join02 (template_tests.filter_tests.test_regression.RegressionTests.test_join02)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n File \"/home/nessita/fellowship/django/django/test/utils.py\", line 443, in inner\n\treturn func(*args, **kwargs)\n\t\t ^^^^^^^^^^^^^^^^^^^^^\n File \"/home/nessita/fellowship/django/tests/template_tests/utils.py\", line 58, in inner\n\tfunc(self)\n File \"/home/nessita/fellowship/django/tests/template_tests/filter_tests/test_regression.py\", line 21, in test_join02\n\tself.assertEqual(output, some_var.join(some_list))\nAssertionError: '<p>Hello World!</p>&lt;br/&gt;beta & me&lt;br/&gt;<script>Hi!</script>' != '<p>Hello World!</p><br/>beta & me<br/><script>Hi!</script>'\n----------------------------------------------------------------------\nRan 2 tests in 0.007s\n",
  "ground_truth": {
    "files": [
      "django/template/defaultfilters.py"
    ],
    "locations": [
      "django/template/defaultfilters.py::join"
    ]
  },
  "predictions": [
    "tests/template_tests/filter_tests/test_join.py::FunctionTests.test_autoescape_off",
    "tests/template_tests/filter_tests/test_join.py::FunctionTests.test_autoescape",
    "tests/template_tests/filter_tests/test_join.py::FunctionTests.test_noniterable_arg_autoescape_off",
    "tests/template_backends/test_django.py::DjangoTemplatesTests.test_autoescape_off",
    "tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filtertag01",
    "tests/template_backends/test_django.py::DjangoTemplatesTests.test_autoescape_default",
    "tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filters02",
    "tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filters01",
    "tests/template_tests/filter_tests/test_autoescape.py::AutoescapeStringfilterTests.test_autoescape_stringfilter03",
    "tests/template_tests/filter_tests/test_autoescape.py::AutoescapeStringfilterTests.test_autoescape_stringfilter02"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "fce90950bef348803fa7cc3e6bc65f4bce429b82",
    "total_functions_indexed": 26652,
    "retrieval_time_seconds": 0.1279134750366211
  },
  "raw_output": "[{\"doc_id\": \"tests/template_tests/filter_tests/test_join.py::FunctionTests.test_autoescape_off\", \"score\": 0.8362215161323547}, {\"doc_id\": \"tests/template_tests/filter_tests/test_join.py::FunctionTests.test_autoescape\", \"score\": 0.8321775197982788}, {\"doc_id\": \"tests/template_tests/filter_tests/test_join.py::FunctionTests.test_noniterable_arg_autoescape_off\", \"score\": 0.8264917135238647}, {\"doc_id\": \"tests/template_backends/test_django.py::DjangoTemplatesTests.test_autoescape_off\", \"score\": 0.8182590007781982}, {\"doc_id\": \"tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filtertag01\", \"score\": 0.8152549266815186}, {\"doc_id\": \"tests/template_backends/test_django.py::DjangoTemplatesTests.test_autoescape_default\", \"score\": 0.8106045126914978}, {\"doc_id\": \"tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filters02\", \"score\": 0.8083537817001343}, {\"doc_id\": \"tests/template_tests/syntax_tests/test_autoescape.py::AutoescapeTagTests.test_autoescape_filters01\", \"score\": 0.8075117468833923}, {\"doc_id\": \"tests/template_tests/filter_tests/test_autoescape.py::AutoescapeStringfilterTests.test_autoescape_stringfilter03\", \"score\": 0.8049360513687134}, {\"doc_id\": \"tests/template_tests/filter_tests/test_autoescape.py::AutoescapeStringfilterTests.test_autoescape_stringfilter02\", \"score\": 0.8036277294158936}]"
}