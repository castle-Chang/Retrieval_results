{
  "instance_id": "django__django-14580",
  "query": "Missing import statement in generated migration (NameError: name 'models' is not defined)\nDescription\n\t\nI found a bug in Django's latest release: 3.2.4. \nGiven the following contents of models.py:\nfrom django.db import models\nclass MyField(models.TextField):\n\tpass\nclass MyBaseModel(models.Model):\n\tclass Meta:\n\t\tabstract = True\nclass MyMixin:\n\tpass\nclass MyModel(MyMixin, MyBaseModel):\n\tname = MyField(primary_key=True)\nThe makemigrations command will generate the following migration file:\n# Generated by Django 3.2.4 on 2021-06-30 19:13\nimport app.models\nfrom django.db import migrations\nclass Migration(migrations.Migration):\n\tinitial = True\n\tdependencies = [\n\t]\n\toperations = [\n\t\tmigrations.CreateModel(\n\t\t\tname='MyModel',\n\t\t\tfields=[\n\t\t\t\t('name', app.models.MyField(primary_key=True, serialize=False)),\n\t\t\t],\n\t\t\toptions={\n\t\t\t\t'abstract': False,\n\t\t\t},\n\t\t\tbases=(app.models.MyMixin, models.Model),\n\t\t),\n\t]\nWhich will then fail with the following error:\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 7, in <module>\n\tclass Migration(migrations.Migration):\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 23, in Migration\n\tbases=(app.models.MyMixin, models.Model),\nNameError: name 'models' is not defined\nExpected behavior: Django generates a migration file that is valid Python.\nActual behavior: Django generates a migration file that is missing an import statement.\nI think this is a bug of the module django.db.migrations.writer, but I'm not sure. I will be happy to assist with debugging.\nThanks for your attention,\nJaap Joris\n",
  "ground_truth": {
    "files": [
      "django/db/migrations/serializer.py"
    ],
    "locations": [
      "django/db/migrations/serializer.py::TypeSerializer",
      "django/db/migrations/serializer.py::TypeSerializer.serialize"
    ]
  },
  "predictions": [
    "tests/migrations/test_writer.py::WriterTests.test_models_import_omitted",
    "django/db/backends/base/introspection.py::BaseDatabaseIntrospection.installed_models",
    "django/db/migrations/operations/models.py::CreateModel.database_forwards",
    "django/db/migrations/autodetector.py::MigrationAutodetector.generate_deleted_models",
    "django/db/backends/base/introspection.py::BaseDatabaseIntrospection.get_migratable_models",
    "django/db/migrations/operations/models.py::CreateModel.__init__",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_disabled_migrations_for_app",
    "django/db/migrations/state.py::ModelState.render",
    "django/db/migrations/recorder.py::MigrationRecorder.ensure_schema",
    "django/db/migrations/operations/models.py::CreateModel.describe"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "36fa071d6ebd18a61c4d7f1b5c9d17106134bd44",
    "total_functions_indexed": 24708,
    "retrieval_time_seconds": 0.10406780242919922
  },
  "raw_output": "[{\"doc_id\": \"tests/migrations/test_writer.py::WriterTests.test_models_import_omitted\", \"score\": 0.7747177481651306}, {\"doc_id\": \"django/db/backends/base/introspection.py::BaseDatabaseIntrospection.installed_models\", \"score\": 0.7284843325614929}, {\"doc_id\": \"django/db/migrations/operations/models.py::CreateModel.database_forwards\", \"score\": 0.7284054160118103}, {\"doc_id\": \"django/db/migrations/autodetector.py::MigrationAutodetector.generate_deleted_models\", \"score\": 0.7262965440750122}, {\"doc_id\": \"django/db/backends/base/introspection.py::BaseDatabaseIntrospection.get_migratable_models\", \"score\": 0.7232043743133545}, {\"doc_id\": \"django/db/migrations/operations/models.py::CreateModel.__init__\", \"score\": 0.7228850722312927}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_disabled_migrations_for_app\", \"score\": 0.7218359708786011}, {\"doc_id\": \"django/db/migrations/state.py::ModelState.render\", \"score\": 0.7217415571212769}, {\"doc_id\": \"django/db/migrations/recorder.py::MigrationRecorder.ensure_schema\", \"score\": 0.7211328744888306}, {\"doc_id\": \"django/db/migrations/operations/models.py::CreateModel.describe\", \"score\": 0.7193307876586914}]"
}