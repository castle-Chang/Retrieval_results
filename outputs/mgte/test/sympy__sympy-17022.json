{
  "instance_id": "sympy__sympy-17022",
  "query": "Lambdify misinterprets some matrix expressions\nUsing lambdify on an expression containing an identity matrix gives us an unexpected result:\r\n\r\n```python\r\n>>> import numpy as np\r\n>>> n = symbols('n', integer=True)\r\n>>> A = MatrixSymbol(\"A\", n, n)\r\n>>> a = np.array([[1, 2], [3, 4]])\r\n>>> f = lambdify(A, A + Identity(n))\r\n>>> f(a)\r\narray([[1.+1.j, 2.+1.j],\r\n       [3.+1.j, 4.+1.j]])\r\n```\r\n\r\nInstead, the output should be  `array([[2, 2], [3, 5]])`, since we're adding an identity matrix to the array. Inspecting the globals and source code of `f` shows us why we get the result:\r\n\r\n```python\r\n>>> import inspect\r\n>>> print(inspect.getsource(f))\r\ndef _lambdifygenerated(A):\r\n    return (I + A)\r\n>>> f.__globals__['I']\r\n1j\r\n```\r\n\r\nThe code printer prints `I`, which is currently being interpreted as a Python built-in complex number. The printer should support printing identity matrices, and signal an error for unsupported expressions that might be misinterpreted.\n",
  "ground_truth": {
    "files": [
      "sympy/printing/pycode.py"
    ],
    "locations": [
      "sympy/printing/pycode.py::NumPyPrinter",
      "sympy/printing/pycode.py::NumPyPrinter._print_MatrixBase",
      "sympy/printing/pycode.py::NumPyPrinter._print_BlockMatrix"
    ]
  },
  "predictions": [
    "sympy/utilities/lambdify.py::lambdify",
    "sympy/utilities/tests/test_lambdify.py::test_issue_15827",
    "sympy/utilities/tests/test_lambdify.py::test_MatrixSymbol_issue_15578",
    "sympy/utilities/tests/test_lambdify.py::test_lambdify_inspect",
    "sympy/external/tests/test_numpy.py::test_lambdify_matrix",
    "sympy/utilities/lambdify.py::lambdastr",
    "sympy/utilities/tests/test_lambdify.py::test_lambdify_docstring",
    "sympy/utilities/tests/test_lambdify.py::test_issue_9334",
    "sympy/external/tests/test_numpy.py::test_lambdify_matrix_multi_input",
    "sympy/plotting/experimental_lambdify.py::vectorized_lambdify.__call__"
  ],
  "metadata": {
    "repo": "sympy/sympy",
    "commit": "f91de695585c1fbc7d4f49ee061f64fcb1c2c4d8",
    "total_functions_indexed": 25253,
    "retrieval_time_seconds": 0.016974925994873047
  },
  "raw_output": "[{\"doc_id\": \"sympy/utilities/lambdify.py::lambdify\", \"score\": 0.7887054681777954}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_issue_15827\", \"score\": 0.779418408870697}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_MatrixSymbol_issue_15578\", \"score\": 0.7750003933906555}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_lambdify_inspect\", \"score\": 0.7724440097808838}, {\"doc_id\": \"sympy/external/tests/test_numpy.py::test_lambdify_matrix\", \"score\": 0.7665061354637146}, {\"doc_id\": \"sympy/utilities/lambdify.py::lambdastr\", \"score\": 0.7615309953689575}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_lambdify_docstring\", \"score\": 0.7601423263549805}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_issue_9334\", \"score\": 0.7565547227859497}, {\"doc_id\": \"sympy/external/tests/test_numpy.py::test_lambdify_matrix_multi_input\", \"score\": 0.7555298805236816}, {\"doc_id\": \"sympy/plotting/experimental_lambdify.py::vectorized_lambdify.__call__\", \"score\": 0.7531022429466248}]"
}