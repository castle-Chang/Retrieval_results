{
  "instance_id": "scikit-learn__scikit-learn-13142",
  "query": "GaussianMixture predict and fit_predict disagree when n_init>1\n#### Description\r\nWhen `n_init` is specified in GaussianMixture, the results of fit_predict(X) and predict(X) are often different.  The `test_gaussian_mixture_fit_predict` unit test doesn't catch this because it does not set `n_init`.\r\n\r\n#### Steps/Code to Reproduce\r\n```\r\npython\r\nfrom sklearn.mixture import GaussianMixture\r\nfrom sklearn.utils.testing import assert_array_equal\r\nimport numpy\r\nX = numpy.random.randn(1000,5)\r\nprint 'no n_init'\r\ngm = GaussianMixture(n_components=5)\r\nc1 = gm.fit_predict(X)\r\nc2 = gm.predict(X)\r\nassert_array_equal(c1,c2)\r\nprint 'n_init=5'\r\ngm = GaussianMixture(n_components=5, n_init=5)\r\nc1 = gm.fit_predict(X)\r\nc2 = gm.predict(X)\r\nassert_array_equal(c1,c2)\r\n```\r\n\r\n#### Expected Results\r\n```\r\nno n_init\r\nn_init=5\r\n```\r\nNo exceptions.\r\n\r\n#### Actual Results\r\n```\r\nno n_init\r\nn_init=5\r\nTraceback (most recent call last):\r\n  File \"test_gm.py\", line 17, in <module>\r\n    assert_array_equal(c1,c2)\r\n  File \"/home/scott/.local/lib/python2.7/site-packages/numpy/testing/_private/utils.py\", line 872, in assert_array_equal\r\n    verbose=verbose, header='Arrays are not equal')\r\n  File \"/home/scott/.local/lib/python2.7/site-packages/numpy/testing/_private/utils.py\", line 796, in assert_array_compare\r\n    raise AssertionError(msg)\r\nAssertionError: \r\nArrays are not equal\r\n\r\n(mismatch 88.6%)\r\n x: array([4, 0, 1, 1, 1, 3, 3, 4, 4, 2, 0, 0, 1, 2, 0, 2, 0, 1, 3, 1, 1, 3,\r\n       2, 1, 0, 2, 1, 0, 2, 0, 3, 1, 2, 3, 3, 1, 0, 2, 2, 0, 3, 0, 2, 0,\r\n       4, 2, 3, 0, 4, 2, 4, 1, 0, 2, 2, 1, 3, 2, 1, 4, 0, 2, 2, 1, 1, 2,...\r\n y: array([4, 1, 0, 2, 2, 1, 1, 4, 4, 0, 4, 1, 0, 3, 1, 0, 2, 2, 1, 2, 0, 0,\r\n       1, 0, 4, 1, 0, 4, 0, 1, 1, 2, 3, 1, 4, 0, 1, 4, 4, 4, 0, 1, 0, 2,\r\n       4, 1, 1, 2, 4, 3, 4, 0, 2, 3, 2, 3, 0, 0, 2, 3, 3, 3, 3, 0, 3, 2,...\r\n```\r\n\r\n#### Versions\r\n```\r\nSystem:\r\n    python: 2.7.15rc1 (default, Nov 12 2018, 14:31:15)  [GCC 7.3.0]\r\n   machine: Linux-4.15.0-43-generic-x86_64-with-Ubuntu-18.04-bionic\r\nexecutable: /usr/bin/python\r\n\r\nBLAS:\r\n    macros: HAVE_CBLAS=None, NO_ATLAS_INFO=-1\r\ncblas_libs: cblas\r\n  lib_dirs: /usr/lib/x86_64-linux-gnu\r\n\r\nPython deps:\r\n    Cython: 0.28.5\r\n     scipy: 1.2.0\r\nsetuptools: 39.0.1\r\n       pip: 19.0.1\r\n     numpy: 1.16.0\r\n    pandas: 0.23.1\r\n   sklearn: 0.20.2\r\n```\n",
  "ground_truth": {
    "files": [
      "sklearn/mixture/base.py"
    ],
    "locations": [
      "sklearn/mixture/base.py::BaseMixture",
      "sklearn/mixture/base.py::BaseMixture.fit_predict",
      "sklearn/mixture/base.py::BaseMixture._e_step"
    ]
  },
  "predictions": [
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_multiple_init",
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_init",
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_predict_predict_proba",
    "sklearn/mixture/gaussian_mixture.py::GaussianMixture.__init__",
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_fit_predict",
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_attributes",
    "sklearn/mixture/tests/test_bayesian_mixture.py::test_bayesian_mixture_mean_prior_initialisation",
    "sklearn/mixture/tests/test_bayesian_mixture.py::test_bayesian_mixture_weights_prior_initialisation",
    "sklearn/mixture/tests/test_gaussian_mixture.py::test_sample",
    "sklearn/cluster/tests/test_k_means.py::test_k_means_n_init"
  ],
  "metadata": {
    "repo": "scikit-learn/scikit-learn",
    "commit": "1c8668b0a021832386470ddf740d834e02c66f69",
    "total_functions_indexed": 6697,
    "retrieval_time_seconds": 0.27095484733581543
  },
  "raw_output": "[{\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_multiple_init\", \"score\": 0.8170634508132935}, {\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_init\", \"score\": 0.8148516416549683}, {\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_predict_predict_proba\", \"score\": 0.7763645052909851}, {\"doc_id\": \"sklearn/mixture/gaussian_mixture.py::GaussianMixture.__init__\", \"score\": 0.768775224685669}, {\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_fit_predict\", \"score\": 0.767482340335846}, {\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_gaussian_mixture_attributes\", \"score\": 0.7657355666160583}, {\"doc_id\": \"sklearn/mixture/tests/test_bayesian_mixture.py::test_bayesian_mixture_mean_prior_initialisation\", \"score\": 0.7652218341827393}, {\"doc_id\": \"sklearn/mixture/tests/test_bayesian_mixture.py::test_bayesian_mixture_weights_prior_initialisation\", \"score\": 0.76390540599823}, {\"doc_id\": \"sklearn/mixture/tests/test_gaussian_mixture.py::test_sample\", \"score\": 0.7626172304153442}, {\"doc_id\": \"sklearn/cluster/tests/test_k_means.py::test_k_means_n_init\", \"score\": 0.7584289312362671}]"
}