{
  "instance_id": "matplotlib__matplotlib-25442",
  "query": "[Bug]: Attribute Error combining matplotlib 3.7.1 and mplcursor on data selection\n### Bug summary\r\n\r\nIf you combine mplcursor and matplotlib 3.7.1, you'll get an `AttributeError: 'NoneType' object has no attribute 'canvas'` after clicking a few data points. Henceforth, selecting a new data point will trigger the same traceback. Otherwise, it works fine. \r\n\r\n### Code for reproduction\r\n\r\n```python\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nimport mplcursors as mpl\r\n\r\nx = np.arange(1, 11)    \r\ny1 = x\r\n\r\nplt.scatter(x,y1)\r\n\r\nmpl.cursor()\r\nplt.show()\r\n```\r\n\r\n\r\n### Actual outcome\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\Users\\MrAni\\Python\\miniconda3\\lib\\site-packages\\matplotlib\\cbook\\__init__.py\", line 304, in process\r\n    func(*args, **kwargs)\r\n  File \"C:\\Users\\MrAni\\Python\\miniconda3\\lib\\site-packages\\matplotlib\\offsetbox.py\", line 1550, in on_release\r\n    if self._check_still_parented() and self.got_artist:\r\n  File \"C:\\Users\\MrAni\\Python\\miniconda3\\lib\\site-packages\\matplotlib\\offsetbox.py\", line 1560, in _check_still_parented\r\n    self.disconnect()\r\n  File \"C:\\Users\\MrAni\\Python\\miniconda3\\lib\\site-packages\\matplotlib\\offsetbox.py\", line 1568, in disconnect\r\n    self.canvas.mpl_disconnect(cid)\r\n  File \"C:\\Users\\MrAni\\Python\\miniconda3\\lib\\site-packages\\matplotlib\\offsetbox.py\", line 1517, in <lambda>\r\n    canvas = property(lambda self: self.ref_artist.figure.canvas)\r\nAttributeError: 'NoneType' object has no attribute 'canvas'\r\n```\r\n\r\n### Expected outcome\r\n\r\nNo terminal output\r\n\r\n### Additional information\r\n\r\nUsing matplotlib 3.7.0 or lower works fine. Using a conda install or pip install doesn't affect the output. \r\n\r\n### Operating system\r\n\r\nWindows 11 and Windwos 10 \r\n\r\n### Matplotlib Version\r\n\r\n3.7.1\r\n\r\n### Matplotlib Backend\r\n\r\nQtAgg\r\n\r\n### Python version\r\n\r\n3.9.16\r\n\r\n### Jupyter version\r\n\r\n_No response_\r\n\r\n### Installation\r\n\r\nconda\n",
  "ground_truth": {
    "files": [
      "lib/matplotlib/offsetbox.py"
    ],
    "locations": [
      "lib/matplotlib/offsetbox.py::DraggableBase",
      "lib/matplotlib/offsetbox.py::DraggableBase.__init__",
      "lib/matplotlib/offsetbox.py::DraggableBase.on_motion",
      "lib/matplotlib/offsetbox.py::DraggableBase.on_pick",
      "lib/matplotlib/offsetbox.py::DraggableBase.on_release",
      "lib/matplotlib/offsetbox.py::DraggableBase.disconnect",
      "lib/matplotlib/offsetbox.py::DraggableBase.save_offset"
    ]
  },
  "predictions": [
    "lib/matplotlib/backends/backend_qt.py::FigureCanvasQT.set_cursor",
    "lib/matplotlib/backend_bases.py::FigureCanvasBase.set_cursor",
    "lib/matplotlib/widgets.py::SpanSelector._set_cursor",
    "lib/matplotlib/backends/backend_webagg_core.py::FigureCanvasWebAggCore.set_cursor",
    "lib/matplotlib/backends/backend_gtk3.py::FigureCanvasGTK3.set_cursor",
    "lib/matplotlib/offsetbox.py::_bbox_artist",
    "lib/matplotlib/artist.py::Artist.set_mouseover",
    "lib/matplotlib/backends/backend_gtk4.py::FigureCanvasGTK4.set_cursor",
    "lib/matplotlib/widgets.py::MultiCursor.__init__",
    "lib/matplotlib/offsetbox.py::bbox_artist"
  ],
  "metadata": {
    "repo": "matplotlib/matplotlib",
    "commit": "73394f2b11321e03a5df199ec0196f27a728b0b0",
    "total_functions_indexed": 9113,
    "retrieval_time_seconds": 0.18152236938476562
  },
  "raw_output": "[{\"doc_id\": \"lib/matplotlib/backends/backend_qt.py::FigureCanvasQT.set_cursor\", \"score\": 0.7493931651115417}, {\"doc_id\": \"lib/matplotlib/backend_bases.py::FigureCanvasBase.set_cursor\", \"score\": 0.7324024438858032}, {\"doc_id\": \"lib/matplotlib/widgets.py::SpanSelector._set_cursor\", \"score\": 0.7301589250564575}, {\"doc_id\": \"lib/matplotlib/backends/backend_webagg_core.py::FigureCanvasWebAggCore.set_cursor\", \"score\": 0.7292450070381165}, {\"doc_id\": \"lib/matplotlib/backends/backend_gtk3.py::FigureCanvasGTK3.set_cursor\", \"score\": 0.7268908023834229}, {\"doc_id\": \"lib/matplotlib/offsetbox.py::_bbox_artist\", \"score\": 0.7248988151550293}, {\"doc_id\": \"lib/matplotlib/artist.py::Artist.set_mouseover\", \"score\": 0.7231577634811401}, {\"doc_id\": \"lib/matplotlib/backends/backend_gtk4.py::FigureCanvasGTK4.set_cursor\", \"score\": 0.7229330539703369}, {\"doc_id\": \"lib/matplotlib/widgets.py::MultiCursor.__init__\", \"score\": 0.7217779159545898}, {\"doc_id\": \"lib/matplotlib/offsetbox.py::bbox_artist\", \"score\": 0.7214163541793823}]"
}