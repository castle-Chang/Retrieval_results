{
  "instance_id": "django__django-14580",
  "query": "Missing import statement in generated migration (NameError: name 'models' is not defined)\nDescription\n\t\nI found a bug in Django's latest release: 3.2.4. \nGiven the following contents of models.py:\nfrom django.db import models\nclass MyField(models.TextField):\n\tpass\nclass MyBaseModel(models.Model):\n\tclass Meta:\n\t\tabstract = True\nclass MyMixin:\n\tpass\nclass MyModel(MyMixin, MyBaseModel):\n\tname = MyField(primary_key=True)\nThe makemigrations command will generate the following migration file:\n# Generated by Django 3.2.4 on 2021-06-30 19:13\nimport app.models\nfrom django.db import migrations\nclass Migration(migrations.Migration):\n\tinitial = True\n\tdependencies = [\n\t]\n\toperations = [\n\t\tmigrations.CreateModel(\n\t\t\tname='MyModel',\n\t\t\tfields=[\n\t\t\t\t('name', app.models.MyField(primary_key=True, serialize=False)),\n\t\t\t],\n\t\t\toptions={\n\t\t\t\t'abstract': False,\n\t\t\t},\n\t\t\tbases=(app.models.MyMixin, models.Model),\n\t\t),\n\t]\nWhich will then fail with the following error:\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 7, in <module>\n\tclass Migration(migrations.Migration):\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 23, in Migration\n\tbases=(app.models.MyMixin, models.Model),\nNameError: name 'models' is not defined\nExpected behavior: Django generates a migration file that is valid Python.\nActual behavior: Django generates a migration file that is missing an import statement.\nI think this is a bug of the module django.db.migrations.writer, but I'm not sure. I will be happy to assist with debugging.\nThanks for your attention,\nJaap Joris\n",
  "ground_truth": {
    "files": [
      "django/db/migrations/serializer.py"
    ],
    "locations": [
      "django/db/migrations/serializer.py::TypeSerializer",
      "django/db/migrations/serializer.py::TypeSerializer.serialize"
    ]
  },
  "predictions": [
    "django/db/migrations/recorder.py::MigrationRecorder.Migration",
    "django/db/migrations/writer.py::MigrationWriter.as_string",
    "tests/migrations/test_writer.py::WriterTests.test_sorted_imports",
    "tests/migrations/test_writer.py::WriterTests.test_models_import_omitted",
    "tests/migrations/test_executor.py::ExecutorTests.test_migrations_applied_and_recorded_atomically",
    "tests/migrations/test_writer.py::WriterTests.test_simple_migration",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_dry_run_verbosity_3",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_path_not_exist",
    "django/db/migrations/executor.py::MigrationExecutor.detect_soft_applied",
    "django/db/migrations/autodetector.py::MigrationAutodetector.arrange_for_graph"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "36fa071d6ebd18a61c4d7f1b5c9d17106134bd44",
    "total_functions_indexed": 24708,
    "retrieval_time_seconds": 1.8451948165893555
  },
  "raw_output": "[{\"doc_id\": \"django/db/migrations/recorder.py::MigrationRecorder.Migration\", \"score\": 263.87711935256397}, {\"doc_id\": \"django/db/migrations/writer.py::MigrationWriter.as_string\", \"score\": 254.3926013080792}, {\"doc_id\": \"tests/migrations/test_writer.py::WriterTests.test_sorted_imports\", \"score\": 252.94883784238624}, {\"doc_id\": \"tests/migrations/test_writer.py::WriterTests.test_models_import_omitted\", \"score\": 239.9318611524058}, {\"doc_id\": \"tests/migrations/test_executor.py::ExecutorTests.test_migrations_applied_and_recorded_atomically\", \"score\": 239.40629809697543}, {\"doc_id\": \"tests/migrations/test_writer.py::WriterTests.test_simple_migration\", \"score\": 236.89992558066064}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_dry_run_verbosity_3\", \"score\": 226.6715696351902}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_path_not_exist\", \"score\": 221.02172575449052}, {\"doc_id\": \"django/db/migrations/executor.py::MigrationExecutor.detect_soft_applied\", \"score\": 219.15612504521005}, {\"doc_id\": \"django/db/migrations/autodetector.py::MigrationAutodetector.arrange_for_graph\", \"score\": 217.8792997349376}]"
}