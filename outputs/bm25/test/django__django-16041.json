{
  "instance_id": "django__django-16041",
  "query": "Rendering empty_form crashes when empty_permitted is passed to form_kwargs\nDescription\n\t\nIssue\nWhen explicitly setting form_kwargs = {'empty_permitted':True} or form_kwargs = {'empty_permitted':False} , a KeyError occurs when rendering a template that uses a formset's empty_form.\nExpected Behavior\nempty_permitted is ignored for formset.empty_form since empty_permitted is irrelevant for empty_form, as empty_form is not meant to be used to pass data and therefore does not need to be validated.\nSteps to Reproduce\n# views.py\nfrom django.shortcuts import render\nfrom .models import MyModel\ndef test_view(request):\n\tcontext = {}\n\tff = modelformset_factory(MyModel, fields = ['a_field'])\n\tcontext['formset'] = ff(\n\t\tqueryset = MyModel.objects.none(),\n\t\tform_kwargs = {'empty_permitted':True} # or form_kwargs = {'empty_permitted':False}\n\t)\n\treturn render(request, 'my_app/my_model_formset.html', context)\n# urls.py\nfrom django.urls import path, include\nfrom .views import test_view\nurlpatterns = [\n\tpath('test', test_view)\n]\n# my_model_formset.html\n{% extends \"my_app/base.html\" %}\n{% block content %}\n<form id=\"my-form\" method=\"post\">\n {% csrf_token %}\n {{ formset }}\n <input type=\"submit\" value=\"Save\">\n</form>\n{{ formset.empty_form }}\n{% endblock %}\n",
  "ground_truth": {
    "files": [
      "django/forms/formsets.py"
    ],
    "locations": [
      "django/forms/formsets.py::BaseFormSet",
      "django/forms/formsets.py::BaseFormSet.empty_form"
    ]
  },
  "predictions": [
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form",
    "tests/forms_tests/tests/test_forms.py::FormsTestCase.test_empty_permitted",
    "django/forms/formsets.py::BaseFormSet.empty_form",
    "django/contrib/admin/helpers.py::InlineAdminFormSet.fields",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_more_initial_data",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_custom_renderer",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_min_num_displaying_more_than_one_blank_form",
    "django/forms/forms.py::BaseForm.__init__",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_formset",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_formset_dynamic"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "6df9398cce063874ae4d59db126d4adacb0fa8d3",
    "total_functions_indexed": 26156,
    "retrieval_time_seconds": 1.4112865924835205
  },
  "raw_output": "[{\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form\", \"score\": 179.75934078050477}, {\"doc_id\": \"tests/forms_tests/tests/test_forms.py::FormsTestCase.test_empty_permitted\", \"score\": 167.71342136279307}, {\"doc_id\": \"django/forms/formsets.py::BaseFormSet.empty_form\", \"score\": 160.2715487676695}, {\"doc_id\": \"django/contrib/admin/helpers.py::InlineAdminFormSet.fields\", \"score\": 147.8926278656027}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_more_initial_data\", \"score\": 138.2315665526506}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_custom_renderer\", \"score\": 131.09514627683203}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_min_num_displaying_more_than_one_blank_form\", \"score\": 125.92557138723404}, {\"doc_id\": \"django/forms/forms.py::BaseForm.__init__\", \"score\": 125.3379090129544}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_formset\", \"score\": 124.28798766760698}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_formset_dynamic\", \"score\": 122.13809059068109}]"
}