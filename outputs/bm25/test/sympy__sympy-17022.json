{
  "instance_id": "sympy__sympy-17022",
  "query": "Lambdify misinterprets some matrix expressions\nUsing lambdify on an expression containing an identity matrix gives us an unexpected result:\r\n\r\n```python\r\n>>> import numpy as np\r\n>>> n = symbols('n', integer=True)\r\n>>> A = MatrixSymbol(\"A\", n, n)\r\n>>> a = np.array([[1, 2], [3, 4]])\r\n>>> f = lambdify(A, A + Identity(n))\r\n>>> f(a)\r\narray([[1.+1.j, 2.+1.j],\r\n       [3.+1.j, 4.+1.j]])\r\n```\r\n\r\nInstead, the output should be  `array([[2, 2], [3, 5]])`, since we're adding an identity matrix to the array. Inspecting the globals and source code of `f` shows us why we get the result:\r\n\r\n```python\r\n>>> import inspect\r\n>>> print(inspect.getsource(f))\r\ndef _lambdifygenerated(A):\r\n    return (I + A)\r\n>>> f.__globals__['I']\r\n1j\r\n```\r\n\r\nThe code printer prints `I`, which is currently being interpreted as a Python built-in complex number. The printer should support printing identity matrices, and signal an error for unsupported expressions that might be misinterpreted.\n",
  "ground_truth": {
    "files": [
      "sympy/printing/pycode.py"
    ],
    "locations": [
      "sympy/printing/pycode.py::NumPyPrinter",
      "sympy/printing/pycode.py::NumPyPrinter._print_MatrixBase",
      "sympy/printing/pycode.py::NumPyPrinter._print_BlockMatrix"
    ]
  },
  "predictions": [
    "sympy/utilities/lambdify.py::lambdify",
    "sympy/printing/julia.py::julia_code",
    "sympy/printing/octave.py::octave_code",
    "sympy/utilities/autowrap.py::ufuncify",
    "sympy/printing/rust.py::rust_code",
    "sympy/printing/glsl.py::glsl_code",
    "sympy/tensor/tensor.py::TensExpr.replace_with_arrays",
    "examples/advanced/autowrap_integrators.py::main",
    "sympy/utilities/tests/test_lambdify.py::test_numpy_matrix",
    "sympy/solvers/solvers.py::nsolve"
  ],
  "metadata": {
    "repo": "sympy/sympy",
    "commit": "f91de695585c1fbc7d4f49ee061f64fcb1c2c4d8",
    "total_functions_indexed": 25253,
    "retrieval_time_seconds": 1.348525047302246
  },
  "raw_output": "[{\"doc_id\": \"sympy/utilities/lambdify.py::lambdify\", \"score\": 282.24661129913744}, {\"doc_id\": \"sympy/printing/julia.py::julia_code\", \"score\": 209.1431464194494}, {\"doc_id\": \"sympy/printing/octave.py::octave_code\", \"score\": 207.5390181912804}, {\"doc_id\": \"sympy/utilities/autowrap.py::ufuncify\", \"score\": 199.45090081559619}, {\"doc_id\": \"sympy/printing/rust.py::rust_code\", \"score\": 196.68702299151295}, {\"doc_id\": \"sympy/printing/glsl.py::glsl_code\", \"score\": 196.02402553237576}, {\"doc_id\": \"sympy/tensor/tensor.py::TensExpr.replace_with_arrays\", \"score\": 194.7166415641862}, {\"doc_id\": \"examples/advanced/autowrap_integrators.py::main\", \"score\": 193.18216038466193}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_numpy_matrix\", \"score\": 190.1749354320981}, {\"doc_id\": \"sympy/solvers/solvers.py::nsolve\", \"score\": 190.13495909499972}]"
}