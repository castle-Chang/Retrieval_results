{
  "instance_id": "matplotlib__matplotlib-25079",
  "query": "[Bug]: Setting norm with existing colorbar fails with 3.6.3\n### Bug summary\r\n\r\nSetting the norm to a `LogNorm` after the colorbar has been created (e.g. in interactive code) fails with an `Invalid vmin` value in matplotlib 3.6.3.\r\n\r\nThe same code worked in previous matplotlib versions.\r\n\r\nNot that vmin and vmax are explicitly set to values valid for `LogNorm` and no negative values (or values == 0) exist in the input data.\r\n\r\n### Code for reproduction\r\n\r\n```python\r\nimport matplotlib.pyplot as plt\r\nfrom matplotlib.colors import LogNorm\r\nimport numpy as np\r\n\r\n# create some random data to fill a 2d plot\r\nrng = np.random.default_rng(0)\r\nimg = rng.uniform(1, 5, (25, 25))\r\n\r\n# plot it\r\nfig, ax = plt.subplots(layout=\"constrained\")\r\nplot = ax.pcolormesh(img)\r\ncbar = fig.colorbar(plot, ax=ax)\r\n\r\nvmin = 1\r\nvmax = 5\r\n\r\nplt.ion()\r\nfig.show()\r\nplt.pause(0.5)\r\n\r\nplot.norm = LogNorm(vmin, vmax)\r\nplot.autoscale()\r\nplt.pause(0.5)\r\n```\r\n\r\n\r\n### Actual outcome\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/backends/backend_qt.py\", line 454, in _draw_idle\r\n    self.draw()\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/backends/backend_agg.py\", line 405, in draw\r\n    self.figure.draw(self.renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/artist.py\", line 74, in draw_wrapper\r\n    result = draw(artist, renderer, *args, **kwargs)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/artist.py\", line 51, in draw_wrapper\r\n    return draw(artist, renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/figure.py\", line 3082, in draw\r\n    mimage._draw_list_compositing_images(\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/image.py\", line 131, in _draw_list_compositing_images\r\n    a.draw(renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/artist.py\", line 51, in draw_wrapper\r\n    return draw(artist, renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/axes/_base.py\", line 3100, in draw\r\n    mimage._draw_list_compositing_images(\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/image.py\", line 131, in _draw_list_compositing_images\r\n    a.draw(renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/artist.py\", line 51, in draw_wrapper\r\n    return draw(artist, renderer)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/collections.py\", line 2148, in draw\r\n    self.update_scalarmappable()\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/collections.py\", line 891, in update_scalarmappable\r\n    self._mapped_colors = self.to_rgba(self._A, self._alpha)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/cm.py\", line 511, in to_rgba\r\n    x = self.norm(x)\r\n  File \"/home/mnoethe/.local/conda/envs/cta-dev/lib/python3.9/site-packages/matplotlib/colors.py\", line 1694, in __call__\r\n    raise ValueError(\"Invalid vmin or vmax\")\r\nValueError: Invalid vmin or vmax\r\n```\r\n\r\n### Expected outcome\r\n\r\nWorks, colorbar and mappable are updated with new norm.\r\n\r\n### Additional information\r\n\r\n_No response_\r\n\r\n### Operating system\r\n\r\nLinux\r\n\r\n### Matplotlib Version\r\n\r\n3.6.3 (works with 3.6.2)\r\n\r\n### Matplotlib Backend\r\n\r\nMultpiple backends tested, same error in all (Qt5Agg, TkAgg, agg, ...)\r\n\r\n### Python version\r\n\r\n3.9.15\r\n\r\n### Jupyter version\r\n\r\nnot in jupyter\r\n\r\n### Installation\r\n\r\nconda\n",
  "ground_truth": {
    "files": [
      "lib/matplotlib/colors.py"
    ],
    "locations": [
      "lib/matplotlib/colors.py::Normalize",
      "lib/matplotlib/colors.py::Normalize.autoscale",
      "lib/matplotlib/colors.py::Normalize.autoscale_None"
    ]
  },
  "predictions": [
    "lib/matplotlib/artist.py::setp",
    "lib/matplotlib/backends/backend_pgf.py::FigureCanvasPgf._print_pgf_to_fh",
    "lib/matplotlib/tests/test_contour.py::test_contourf_log_extension",
    "lib/matplotlib/tests/test_colorbar.py::test_colorbar_minorticks_on_off",
    "lib/matplotlib/artist.py::_prevent_rasterization",
    "lib/matplotlib/__init__.py::_rc_params_in_file",
    "lib/matplotlib/tests/test_backends_interactive.py::_get_testable_interactive_backends",
    "lib/matplotlib/artist.py::allow_rasterization",
    "lib/matplotlib/artist.py::_finalize_rasterization",
    "lib/matplotlib/tests/test_collections.py::test_pathcollection_legend_elements"
  ],
  "metadata": {
    "repo": "matplotlib/matplotlib",
    "commit": "66f7956984cbfc3647e867c6e5fde889a89c64ef",
    "total_functions_indexed": 9160,
    "retrieval_time_seconds": 1.5073273181915283
  },
  "raw_output": "[{\"doc_id\": \"lib/matplotlib/artist.py::setp\", \"score\": 328.52955347366344}, {\"doc_id\": \"lib/matplotlib/backends/backend_pgf.py::FigureCanvasPgf._print_pgf_to_fh\", \"score\": 321.53205637940056}, {\"doc_id\": \"lib/matplotlib/tests/test_contour.py::test_contourf_log_extension\", \"score\": 313.49006578037904}, {\"doc_id\": \"lib/matplotlib/tests/test_colorbar.py::test_colorbar_minorticks_on_off\", \"score\": 311.3555544249553}, {\"doc_id\": \"lib/matplotlib/artist.py::_prevent_rasterization\", \"score\": 307.96989251083045}, {\"doc_id\": \"lib/matplotlib/__init__.py::_rc_params_in_file\", \"score\": 293.5500728723806}, {\"doc_id\": \"lib/matplotlib/tests/test_backends_interactive.py::_get_testable_interactive_backends\", \"score\": 289.56067713155153}, {\"doc_id\": \"lib/matplotlib/artist.py::allow_rasterization\", \"score\": 289.3096409355834}, {\"doc_id\": \"lib/matplotlib/artist.py::_finalize_rasterization\", \"score\": 287.7035182421024}, {\"doc_id\": \"lib/matplotlib/tests/test_collections.py::test_pathcollection_legend_elements\", \"score\": 287.69441220413034}]"
}