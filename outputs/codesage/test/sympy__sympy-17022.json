{
  "instance_id": "sympy__sympy-17022",
  "query": "Lambdify misinterprets some matrix expressions\nUsing lambdify on an expression containing an identity matrix gives us an unexpected result:\r\n\r\n```python\r\n>>> import numpy as np\r\n>>> n = symbols('n', integer=True)\r\n>>> A = MatrixSymbol(\"A\", n, n)\r\n>>> a = np.array([[1, 2], [3, 4]])\r\n>>> f = lambdify(A, A + Identity(n))\r\n>>> f(a)\r\narray([[1.+1.j, 2.+1.j],\r\n       [3.+1.j, 4.+1.j]])\r\n```\r\n\r\nInstead, the output should be  `array([[2, 2], [3, 5]])`, since we're adding an identity matrix to the array. Inspecting the globals and source code of `f` shows us why we get the result:\r\n\r\n```python\r\n>>> import inspect\r\n>>> print(inspect.getsource(f))\r\ndef _lambdifygenerated(A):\r\n    return (I + A)\r\n>>> f.__globals__['I']\r\n1j\r\n```\r\n\r\nThe code printer prints `I`, which is currently being interpreted as a Python built-in complex number. The printer should support printing identity matrices, and signal an error for unsupported expressions that might be misinterpreted.\n",
  "ground_truth": {
    "files": [
      "sympy/printing/pycode.py"
    ],
    "locations": [
      "sympy/printing/pycode.py::NumPyPrinter",
      "sympy/printing/pycode.py::NumPyPrinter._print_MatrixBase",
      "sympy/printing/pycode.py::NumPyPrinter._print_BlockMatrix"
    ]
  },
  "predictions": [
    "sympy/external/tests/test_numpy.py::test_lambdify_matrix",
    "sympy/utilities/lambdify.py::lambdify",
    "sympy/utilities/tests/test_lambdify.py::test_MatrixSymbol_issue_15578",
    "sympy/plotting/experimental_lambdify.py::lambdify.__call__",
    "sympy/matrices/expressions/matexpr.py::Identity._eval_trace",
    "sympy/utilities/tests/test_lambdify.py::test_issue_15827",
    "sympy/utilities/tests/test_lambdify.py::test_numpy_matrix",
    "sympy/matrices/expressions/funcmatrix.py::FunctionMatrix._entry",
    "sympy/matrices/expressions/tests/test_matexpr.py::test_invalid_args",
    "sympy/matrices/expressions/matexpr.py::Identity.__new__"
  ],
  "metadata": {
    "repo": "sympy/sympy",
    "commit": "f91de695585c1fbc7d4f49ee061f64fcb1c2c4d8",
    "total_functions_indexed": 25253,
    "retrieval_time_seconds": 0.311983585357666
  },
  "raw_output": "[{\"doc_id\": \"sympy/external/tests/test_numpy.py::test_lambdify_matrix\", \"score\": 0.4781651496887207}, {\"doc_id\": \"sympy/utilities/lambdify.py::lambdify\", \"score\": 0.46196693181991577}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_MatrixSymbol_issue_15578\", \"score\": 0.4570308327674866}, {\"doc_id\": \"sympy/plotting/experimental_lambdify.py::lambdify.__call__\", \"score\": 0.4547766447067261}, {\"doc_id\": \"sympy/matrices/expressions/matexpr.py::Identity._eval_trace\", \"score\": 0.45139503479003906}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_issue_15827\", \"score\": 0.44770073890686035}, {\"doc_id\": \"sympy/utilities/tests/test_lambdify.py::test_numpy_matrix\", \"score\": 0.4463505148887634}, {\"doc_id\": \"sympy/matrices/expressions/funcmatrix.py::FunctionMatrix._entry\", \"score\": 0.44589874148368835}, {\"doc_id\": \"sympy/matrices/expressions/tests/test_matexpr.py::test_invalid_args\", \"score\": 0.44486790895462036}, {\"doc_id\": \"sympy/matrices/expressions/matexpr.py::Identity.__new__\", \"score\": 0.44229209423065186}]"
}