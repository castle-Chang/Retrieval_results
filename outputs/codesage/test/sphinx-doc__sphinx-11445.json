{
  "instance_id": "sphinx-doc__sphinx-11445",
  "query": "Using rst_prolog removes top level headings containing a domain directive\n### Describe the bug\r\n\r\nIf `rst_prolog` is set, then any documents that contain a domain directive as the first heading (eg `:mod:`) do not render the heading correctly or include the heading in the toctree.\r\n\r\nIn the example below, if the heading of `docs/mypackage.rst` were `mypackage2` instead of `:mod:mypackage2` then the heading displays correctly.\r\nSimilarly, if you do not set `rst_prolog` then the heading will display correctly.\r\n\r\nThis appears to have been broken for some time because I can reproduce it in v4.0.0 of Sphinx\r\n\r\n### How to Reproduce\r\n\r\n```bash\r\n$ sphinx-quickstart --no-sep --project mypackage --author me -v 0.1.0 --release 0.1.0 --language en docs\r\n$ echo -e 'Welcome\\n=======\\n\\n.. toctree::\\n\\n   mypackage\\n' > docs/index.rst\r\n$ echo -e ':mod:`mypackage2`\\n=================\\n\\nContent\\n\\nSubheading\\n----------\\n' > docs/mypackage.rst\r\n$ echo -e 'rst_prolog = \"\"\"\\n.. |psf| replace:: Python Software Foundation\\n\"\"\"\\n' >> docs/conf.py\r\n$ sphinx-build -b html . _build\r\n$ grep 'mypackage2' docs/_build/index.html\r\n```\r\n\r\n`docs/index.rst`:\r\n\r\n```rst\r\nWelcome\r\n=======\r\n\r\n.. toctree::\r\n\r\n   mypackage\r\n```\r\n\r\n`docs/mypackage.rst`:\r\n\r\n```rst\r\n:mod:`mypackage2`\r\n=================\r\n\r\nContent\r\n\r\nSubheading\r\n----------\r\n```\r\n\r\n### Environment Information\r\n\r\n```text\r\nPlatform:              linux; (Linux-6.3.2-arch1-1-x86_64-with-glibc2.37)\r\nPython version:        3.11.3 (main, Apr  5 2023, 15:52:25) [GCC 12.2.1 20230201])\r\nPython implementation: CPython\r\nSphinx version:        7.1.0+/d3c91f951\r\nDocutils version:      0.20.1\r\nJinja2 version:        3.1.2\r\nPygments version:      2.15.1\r\n```\r\n\r\n\r\n### Sphinx extensions\r\n\r\n```python\r\n[]\r\n```\r\n\r\n\r\n### Additional context\r\n\r\n_No response_\n",
  "ground_truth": {
    "files": [
      "sphinx/util/rst.py"
    ],
    "locations": [
      "sphinx/util/rst.py::prepend_prolog"
    ]
  },
  "predictions": [
    "tests/test_util_rst.py::test_prepend_prolog",
    "sphinx/util/rst.py::prepend_prolog",
    "sphinx/parsers.py::RSTParser.decorate",
    "sphinx/domains/rst.py::ReSTDirective.before_content",
    "tests/test_util_rst.py::test_prepend_prolog_without_CR",
    "tests/test_util_rst.py::test_prepend_prolog_with_CR",
    "tests/test_markup.py::test_rst_prolog",
    "sphinx/domains/rst.py::ReSTDirective.after_content",
    "sphinx/domains/rst.py::ReSTDirective.get_index_text",
    "sphinx/domains/rst.py::ReSTMarkup.get_index_text"
  ],
  "metadata": {
    "repo": "sphinx-doc/sphinx",
    "commit": "71db08c05197545944949d5aa76cd340e7143627",
    "total_functions_indexed": 5752,
    "retrieval_time_seconds": 0.0028104782104492188
  },
  "raw_output": "[{\"doc_id\": \"tests/test_util_rst.py::test_prepend_prolog\", \"score\": 0.4852490723133087}, {\"doc_id\": \"sphinx/util/rst.py::prepend_prolog\", \"score\": 0.4833976924419403}, {\"doc_id\": \"sphinx/parsers.py::RSTParser.decorate\", \"score\": 0.4653717875480652}, {\"doc_id\": \"sphinx/domains/rst.py::ReSTDirective.before_content\", \"score\": 0.4576495885848999}, {\"doc_id\": \"tests/test_util_rst.py::test_prepend_prolog_without_CR\", \"score\": 0.4555933177471161}, {\"doc_id\": \"tests/test_util_rst.py::test_prepend_prolog_with_CR\", \"score\": 0.4535660743713379}, {\"doc_id\": \"tests/test_markup.py::test_rst_prolog\", \"score\": 0.4492953419685364}, {\"doc_id\": \"sphinx/domains/rst.py::ReSTDirective.after_content\", \"score\": 0.43982362747192383}, {\"doc_id\": \"sphinx/domains/rst.py::ReSTDirective.get_index_text\", \"score\": 0.4326886534690857}, {\"doc_id\": \"sphinx/domains/rst.py::ReSTMarkup.get_index_text\", \"score\": 0.4294113516807556}]"
}