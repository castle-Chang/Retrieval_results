{
  "instance_id": "django__django-15320",
  "query": "Subquery.as_sql() generates invalid SQL.\nDescription\n\t \n\t\t(last modified by M1ha Shvn)\n\t \nSince â€‹this commit Subquery.as_sql(...) method returns incorrect SQL removing first and last symbols instead of absent breakets. Adding Subquery().query.subquery = True attribute fixes the problem. From my point of view, it should be set in Subquery constructor.\nfrom django.db import connection\nfrom apps.models import App\nq = Subquery(App.objects.all())\nprint(str(q.query))\n# Output SQL is valid:\n# 'SELECT \"apps_app\".\"id\", \"apps_app\".\"name\" FROM \"apps_app\"'\nprint(q.as_sql(q.query.get_compiler('default'), connection))\n# Outptut SQL is invalid (no S letter at the beggining and \" symbol at the end):\n# ('(ELECT \"apps_app\".\"id\", \"apps_app\".\"name\" FROM \"apps_app)', ())\nq.query.subquery = True\nprint(q.as_sql(q.query.get_compiler('default'), connection))\n# Outputs correct result\n('(SELECT \"apps_app\".\"id\", \"apps_app\".\"name\" FROM \"apps_app\")', ())\n",
  "ground_truth": {
    "files": [
      "django/db/models/expressions.py"
    ],
    "locations": [
      "django/db/models/expressions.py::Subquery",
      "django/db/models/expressions.py::Subquery.__init__"
    ]
  },
  "predictions": [
    "tests/multiple_database/tests.py::QueryTestCase.test_subquery",
    "tests/multiple_database/tests.py::RouterTestCase.test_subquery",
    "tests/queries/tests.py::WhereNodeTest.test_empty_nodes",
    "tests/queries/tests.py::WhereNodeTest.test_empty_full_handling_conjunction",
    "tests/queries/tests.py::WhereNodeTest.test_empty_full_handling_disjunction",
    "tests/expressions/tests.py::ValueTests.test_compile_unresolved",
    "tests/expressions/tests.py::BasicExpressionsTests.test_subquery",
    "tests/queries/tests.py::SubqueryTests.test_slice_subquery_and_query",
    "django/db/models/expressions.py::Subquery.as_sql",
    "tests/queries/tests.py::SubqueryTests.test_sliced_delete"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "b55ebe32417e0884b6b8b3e1bc0379033aa221af",
    "total_functions_indexed": 25513,
    "retrieval_time_seconds": 0.095123291015625
  },
  "raw_output": "[{\"doc_id\": \"tests/multiple_database/tests.py::QueryTestCase.test_subquery\", \"score\": 0.5724075436592102}, {\"doc_id\": \"tests/multiple_database/tests.py::RouterTestCase.test_subquery\", \"score\": 0.5717600584030151}, {\"doc_id\": \"tests/queries/tests.py::WhereNodeTest.test_empty_nodes\", \"score\": 0.49583178758621216}, {\"doc_id\": \"tests/queries/tests.py::WhereNodeTest.test_empty_full_handling_conjunction\", \"score\": 0.4868256449699402}, {\"doc_id\": \"tests/queries/tests.py::WhereNodeTest.test_empty_full_handling_disjunction\", \"score\": 0.48009151220321655}, {\"doc_id\": \"tests/expressions/tests.py::ValueTests.test_compile_unresolved\", \"score\": 0.4616144895553589}, {\"doc_id\": \"tests/expressions/tests.py::BasicExpressionsTests.test_subquery\", \"score\": 0.4470290541648865}, {\"doc_id\": \"tests/queries/tests.py::SubqueryTests.test_slice_subquery_and_query\", \"score\": 0.43766576051712036}, {\"doc_id\": \"django/db/models/expressions.py::Subquery.as_sql\", \"score\": 0.4350396394729614}, {\"doc_id\": \"tests/queries/tests.py::SubqueryTests.test_sliced_delete\", \"score\": 0.41700536012649536}]"
}