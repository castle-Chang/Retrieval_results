{
  "instance_id": "django__django-16041",
  "query": "Rendering empty_form crashes when empty_permitted is passed to form_kwargs\nDescription\n\t\nIssue\nWhen explicitly setting form_kwargs = {'empty_permitted':True} or form_kwargs = {'empty_permitted':False} , a KeyError occurs when rendering a template that uses a formset's empty_form.\nExpected Behavior\nempty_permitted is ignored for formset.empty_form since empty_permitted is irrelevant for empty_form, as empty_form is not meant to be used to pass data and therefore does not need to be validated.\nSteps to Reproduce\n# views.py\nfrom django.shortcuts import render\nfrom .models import MyModel\ndef test_view(request):\n\tcontext = {}\n\tff = modelformset_factory(MyModel, fields = ['a_field'])\n\tcontext['formset'] = ff(\n\t\tqueryset = MyModel.objects.none(),\n\t\tform_kwargs = {'empty_permitted':True} # or form_kwargs = {'empty_permitted':False}\n\t)\n\treturn render(request, 'my_app/my_model_formset.html', context)\n# urls.py\nfrom django.urls import path, include\nfrom .views import test_view\nurlpatterns = [\n\tpath('test', test_view)\n]\n# my_model_formset.html\n{% extends \"my_app/base.html\" %}\n{% block content %}\n<form id=\"my-form\" method=\"post\">\n {% csrf_token %}\n {{ formset }}\n <input type=\"submit\" value=\"Save\">\n</form>\n{{ formset.empty_form }}\n{% endblock %}\n",
  "ground_truth": {
    "files": [
      "django/forms/formsets.py"
    ],
    "locations": [
      "django/forms/formsets.py::BaseFormSet",
      "django/forms/formsets.py::BaseFormSet.empty_form"
    ]
  },
  "predictions": [
    "django/forms/formsets.py::BaseFormSet.empty_form",
    "tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_custom_queryset_init",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_model_formset_with_custom_pk",
    "tests/test_utils/tests.py::TestFormset._get_cleaned_formset",
    "tests/model_formsets_regress/tests.py::InlineFormsetTests.test_empty_fields_on_modelformset",
    "tests/forms_tests/tests/test_formsets.py::TestEmptyFormSet.test_empty_formset_is_valid",
    "tests/model_formsets_regress/tests.py::FormsetTests.test_initial_data",
    "tests/model_formsets_regress/tests.py::InlineFormsetTests.test_formset_with_none_instance",
    "tests/model_formsets/tests.py::ModelFormsetTest.test_edit_only_formset_factory_with_basemodelformset"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "6df9398cce063874ae4d59db126d4adacb0fa8d3",
    "total_functions_indexed": 26156,
    "retrieval_time_seconds": 0.008481740951538086
  },
  "raw_output": "[{\"doc_id\": \"django/forms/formsets.py::BaseFormSet.empty_form\", \"score\": 0.5915688276290894}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::FormsFormsetTestCase.test_form_kwargs_empty_form\", \"score\": 0.577982485294342}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_custom_queryset_init\", \"score\": 0.5709999799728394}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_model_formset_with_custom_pk\", \"score\": 0.5675848722457886}, {\"doc_id\": \"tests/test_utils/tests.py::TestFormset._get_cleaned_formset\", \"score\": 0.5466994047164917}, {\"doc_id\": \"tests/model_formsets_regress/tests.py::InlineFormsetTests.test_empty_fields_on_modelformset\", \"score\": 0.5375163555145264}, {\"doc_id\": \"tests/forms_tests/tests/test_formsets.py::TestEmptyFormSet.test_empty_formset_is_valid\", \"score\": 0.5362964868545532}, {\"doc_id\": \"tests/model_formsets_regress/tests.py::FormsetTests.test_initial_data\", \"score\": 0.5352940559387207}, {\"doc_id\": \"tests/model_formsets_regress/tests.py::InlineFormsetTests.test_formset_with_none_instance\", \"score\": 0.534410297870636}, {\"doc_id\": \"tests/model_formsets/tests.py::ModelFormsetTest.test_edit_only_formset_factory_with_basemodelformset\", \"score\": 0.5314518213272095}]"
}