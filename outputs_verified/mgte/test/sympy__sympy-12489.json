{
  "instance_id": "sympy__sympy-12489",
  "query": "combinatorics.Permutation can't be subclassed properly\nI stumbled across a subclassing issue with `combinatorics.Permutation`:\r\nThe object creation is done in `Permutation.__new__`, but internally the function `_af_new` is used (which itself is a reference to the static method `Permutation._af_new`). This method eventually creates the object calling `Basic.__new__(Perm, perm)` (`Perm` is a reference to `Permutation`).\r\nIn the end, this makes subclassing `Permutation` impossible (besides overriding `Permutation._af_new` as always instances of `Permutation` are returned.\r\n\r\nAn elegant solution would be to stick to Python's instance creation mechanisms, i.e. use classmethods where appropriate (`__new__` is one) and use the mandatory reference to the class (the first argument of a classmethod) the method is called on for instance creation.\r\n\r\nI'm completely new to sympy development and encountered this issue whilst trying to subclass `Permutation`. Therefore I'm not aware of any side effects changing the instance creation probably has. (I monkeypatched it locally and ran the tests, all succeeded.)\r\n\r\nMaybe there is a coherent explanation why the implementation is as it is and should not be changed?\n",
  "ground_truth": {
    "files": [
      "sympy/combinatorics/permutations.py"
    ],
    "locations": [
      "sympy/combinatorics/permutations.py::_af_invert",
      "sympy/combinatorics/permutations.py::_af_pow",
      "sympy/combinatorics/permutations.py::_af_commutes_with",
      "sympy/combinatorics/permutations.py::Cycle",
      "sympy/combinatorics/permutations.py::Cycle.copy",
      "sympy/combinatorics/permutations.py::Permutation",
      "sympy/combinatorics/permutations.py::Permutation.__new__",
      "sympy/combinatorics/permutations.py::Permutation._af_new",
      "sympy/combinatorics/permutations.py::Permutation._hashable_content",
      "sympy/combinatorics/permutations.py::Permutation.__add__",
      "sympy/combinatorics/permutations.py::Permutation.__sub__",
      "sympy/combinatorics/permutations.py::Permutation.rmul_with_af",
      "sympy/combinatorics/permutations.py::Permutation.mul_inv",
      "sympy/combinatorics/permutations.py::Permutation.__rmul__",
      "sympy/combinatorics/permutations.py::Permutation.__mul__",
      "sympy/combinatorics/permutations.py::Permutation.commutes_with",
      "sympy/combinatorics/permutations.py::Permutation.__pow__",
      "sympy/combinatorics/permutations.py::Permutation.__rxor__",
      "sympy/combinatorics/permutations.py::Permutation.transpositions",
      "sympy/combinatorics/permutations.py::Permutation.__iter__",
      "sympy/combinatorics/permutations.py::Permutation.unrank_nonlex",
      "sympy/combinatorics/permutations.py::Permutation.rank_nonlex",
      "sympy/combinatorics/permutations.py::Permutation.rank",
      "sympy/combinatorics/permutations.py::Permutation.signature",
      "sympy/combinatorics/permutations.py::Permutation.unrank_trotterjohnson",
      "sympy/combinatorics/permutations.py::Permutation.next_trotterjohnson",
      "sympy/combinatorics/permutations.py::Permutation.get_precedence_matrix",
      "sympy/combinatorics/permutations.py::Permutation.josephus",
      "sympy/combinatorics/permutations.py::Permutation.from_inversion_vector",
      "sympy/combinatorics/permutations.py::Permutation.random",
      "sympy/combinatorics/permutations.py::Permutation.unrank_lex"
    ]
  },
  "predictions": [
    "sympy/combinatorics/permutations.py::Permutation._af_new",
    "sympy/combinatorics/permutations.py::Permutation.__pow__",
    "sympy/combinatorics/perm_groups.py::PermutationGroup.__new__",
    "sympy/combinatorics/permutations.py::Permutation.__rxor__",
    "sympy/combinatorics/permutations.py::Permutation.rmul_with_af",
    "sympy/combinatorics/permutations.py::Permutation.__repr__",
    "sympy/combinatorics/permutations.py::Permutation.support",
    "sympy/combinatorics/permutations.py::Permutation.__sub__",
    "sympy/combinatorics/permutations.py::Permutation.__new__",
    "sympy/combinatorics/permutations.py::Permutation.__rmul__"
  ],
  "metadata": {
    "repo": "sympy/sympy",
    "commit": "aa9780761ad8c3c0f68beeef3a0ce5caac9e100b",
    "total_functions_indexed": 20663,
    "retrieval_time_seconds": 0.003590822219848633
  },
  "raw_output": "[{\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation._af_new\", \"score\": 0.8314263820648193}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__pow__\", \"score\": 0.7757235169410706}, {\"doc_id\": \"sympy/combinatorics/perm_groups.py::PermutationGroup.__new__\", \"score\": 0.7715755105018616}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__rxor__\", \"score\": 0.7705734968185425}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.rmul_with_af\", \"score\": 0.7702654600143433}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__repr__\", \"score\": 0.7460144758224487}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.support\", \"score\": 0.745969295501709}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__sub__\", \"score\": 0.7453293204307556}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__new__\", \"score\": 0.7412716746330261}, {\"doc_id\": \"sympy/combinatorics/permutations.py::Permutation.__rmul__\", \"score\": 0.7332139015197754}]"
}