{
  "instance_id": "django__django-13786",
  "query": "squashmigrations does not unset model options when optimizing CreateModel and AlterModelOptions\nDescription\n\t\nWhen an operation resembling AlterModelOptions(name=\"test_model\", options={}) is squashed into the corresponding CreateModel operation, model options are not cleared on the resulting new CreateModel operation object.\nCreateModel.reduce() sets the new options as options={**self.options, **operation.options} in this case (django/db/migrations/operations/models.py line 144 on commit 991dce4f), with no logic to remove options not found in operation.options as is found in AlterModelOptions.state_forwards().\nI believe this issue still exists on the master branch based on my reading of the code, but I've only tested against 2.2.\n",
  "ground_truth": {
    "files": [
      "django/db/migrations/operations/models.py"
    ],
    "locations": [
      "django/db/migrations/operations/models.py::CreateModel",
      "django/db/migrations/operations/models.py::CreateModel.reduce"
    ]
  },
  "predictions": [
    "django/core/management/commands/squashmigrations.py::Command.handle",
    "django/db/migrations/operations/models.py::CreateModel.reduce",
    "django/db/migrations/operations/models.py::AlterModelOptions.deconstruct",
    "django/db/migrations/operations/models.py::ModelOptionOperation.reduce",
    "django/db/migrations/operations/models.py::AlterTogetherOptionOperation.deconstruct",
    "tests/migrations/test_commands.py::SquashMigrationsTests.test_ticket_23799_squashmigrations_no_optimize",
    "tests/migrations/test_operations.py::OperationTests.test_alter_model_options_emptying",
    "tests/migrations/test_optimizer.py::OptimizerTests.test_create_alter_model_options",
    "tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_squashes",
    "django/db/migrations/operations/models.py::ModelOperation.reduce"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "bb64b99b78a579cb2f6178011a4cf9366e634438",
    "total_functions_indexed": 24230,
    "retrieval_time_seconds": 0.013109922409057617
  },
  "raw_output": "[{\"doc_id\": \"django/core/management/commands/squashmigrations.py::Command.handle\", \"score\": 0.7958250045776367}, {\"doc_id\": \"django/db/migrations/operations/models.py::CreateModel.reduce\", \"score\": 0.7811941504478455}, {\"doc_id\": \"django/db/migrations/operations/models.py::AlterModelOptions.deconstruct\", \"score\": 0.7732847332954407}, {\"doc_id\": \"django/db/migrations/operations/models.py::ModelOptionOperation.reduce\", \"score\": 0.7716634273529053}, {\"doc_id\": \"django/db/migrations/operations/models.py::AlterTogetherOptionOperation.deconstruct\", \"score\": 0.7596755027770996}, {\"doc_id\": \"tests/migrations/test_commands.py::SquashMigrationsTests.test_ticket_23799_squashmigrations_no_optimize\", \"score\": 0.7578163146972656}, {\"doc_id\": \"tests/migrations/test_operations.py::OperationTests.test_alter_model_options_emptying\", \"score\": 0.7542822957038879}, {\"doc_id\": \"tests/migrations/test_optimizer.py::OptimizerTests.test_create_alter_model_options\", \"score\": 0.7541422843933105}, {\"doc_id\": \"tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_squashes\", \"score\": 0.7536354064941406}, {\"doc_id\": \"django/db/migrations/operations/models.py::ModelOperation.reduce\", \"score\": 0.7504521608352661}]"
}