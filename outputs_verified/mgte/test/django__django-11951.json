{
  "instance_id": "django__django-11951",
  "query": "bulk_create batch_size param overrides the compatible batch size calculation\nDescription\n\t \n\t\t(last modified by Ahmet Kucuk)\n\t \nAt this line: ​https://github.com/django/django/blob/stable/2.2.x/django/db/models/query.py#L1197\nbatch_size param overrides compatible batch size calculation. This looks like a bug as bulk_update properly picks the minimum of two:\n​https://github.com/django/django/blob/stable/2.2.x/django/db/models/query.py#L504\nI suggest using similar\n batch_size = min(batch_size, max_batch_size) if batch_size else max_batch_size\nlogic in bulk_create as well. I am happy to open a PR for it.\n",
  "ground_truth": {
    "files": [
      "django/db/models/query.py"
    ],
    "locations": [
      "django/db/models/query.py::QuerySet",
      "django/db/models/query.py::QuerySet._batched_insert"
    ]
  },
  "predictions": [
    "django/db/models/query.py::QuerySet.bulk_create",
    "django/db/backends/sqlite3/operations.py::DatabaseOperations.bulk_batch_size",
    "django/db/backends/oracle/operations.py::DatabaseOperations.bulk_batch_size",
    "django/db/backends/base/operations.py::BaseDatabaseOperations.bulk_batch_size",
    "tests/backends/oracle/test_operations.py::OperationsTests.test_bulk_batch_size",
    "tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size_efficiency",
    "tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size",
    "django/db/models/query.py::QuerySet._batched_insert",
    "tests/queries/test_bulk_update.py::BulkUpdateTests.test_invalid_batch_size",
    "django/db/models/query.py::QuerySet.bulk_update"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "312049091288dbba2299de8d07ea3e3311ed7238",
    "total_functions_indexed": 22905,
    "retrieval_time_seconds": 0.008195161819458008
  },
  "raw_output": "[{\"doc_id\": \"django/db/models/query.py::QuerySet.bulk_create\", \"score\": 0.7654751539230347}, {\"doc_id\": \"django/db/backends/sqlite3/operations.py::DatabaseOperations.bulk_batch_size\", \"score\": 0.7537124156951904}, {\"doc_id\": \"django/db/backends/oracle/operations.py::DatabaseOperations.bulk_batch_size\", \"score\": 0.7502343654632568}, {\"doc_id\": \"django/db/backends/base/operations.py::BaseDatabaseOperations.bulk_batch_size\", \"score\": 0.7433135509490967}, {\"doc_id\": \"tests/backends/oracle/test_operations.py::OperationsTests.test_bulk_batch_size\", \"score\": 0.7352068424224854}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size_efficiency\", \"score\": 0.7321184873580933}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size\", \"score\": 0.7280395030975342}, {\"doc_id\": \"django/db/models/query.py::QuerySet._batched_insert\", \"score\": 0.7267090082168579}, {\"doc_id\": \"tests/queries/test_bulk_update.py::BulkUpdateTests.test_invalid_batch_size\", \"score\": 0.725000262260437}, {\"doc_id\": \"django/db/models/query.py::QuerySet.bulk_update\", \"score\": 0.7121521234512329}]"
}