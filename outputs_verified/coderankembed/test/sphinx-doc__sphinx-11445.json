{
  "instance_id": "sphinx-doc__sphinx-11445",
  "query": "Using rst_prolog removes top level headings containing a domain directive\n### Describe the bug\r\n\r\nIf `rst_prolog` is set, then any documents that contain a domain directive as the first heading (eg `:mod:`) do not render the heading correctly or include the heading in the toctree.\r\n\r\nIn the example below, if the heading of `docs/mypackage.rst` were `mypackage2` instead of `:mod:mypackage2` then the heading displays correctly.\r\nSimilarly, if you do not set `rst_prolog` then the heading will display correctly.\r\n\r\nThis appears to have been broken for some time because I can reproduce it in v4.0.0 of Sphinx\r\n\r\n### How to Reproduce\r\n\r\n```bash\r\n$ sphinx-quickstart --no-sep --project mypackage --author me -v 0.1.0 --release 0.1.0 --language en docs\r\n$ echo -e 'Welcome\\n=======\\n\\n.. toctree::\\n\\n   mypackage\\n' > docs/index.rst\r\n$ echo -e ':mod:`mypackage2`\\n=================\\n\\nContent\\n\\nSubheading\\n----------\\n' > docs/mypackage.rst\r\n$ echo -e 'rst_prolog = \"\"\"\\n.. |psf| replace:: Python Software Foundation\\n\"\"\"\\n' >> docs/conf.py\r\n$ sphinx-build -b html . _build\r\n$ grep 'mypackage2' docs/_build/index.html\r\n```\r\n\r\n`docs/index.rst`:\r\n\r\n```rst\r\nWelcome\r\n=======\r\n\r\n.. toctree::\r\n\r\n   mypackage\r\n```\r\n\r\n`docs/mypackage.rst`:\r\n\r\n```rst\r\n:mod:`mypackage2`\r\n=================\r\n\r\nContent\r\n\r\nSubheading\r\n----------\r\n```\r\n\r\n### Environment Information\r\n\r\n```text\r\nPlatform:              linux; (Linux-6.3.2-arch1-1-x86_64-with-glibc2.37)\r\nPython version:        3.11.3 (main, Apr  5 2023, 15:52:25) [GCC 12.2.1 20230201])\r\nPython implementation: CPython\r\nSphinx version:        7.1.0+/d3c91f951\r\nDocutils version:      0.20.1\r\nJinja2 version:        3.1.2\r\nPygments version:      2.15.1\r\n```\r\n\r\n\r\n### Sphinx extensions\r\n\r\n```python\r\n[]\r\n```\r\n\r\n\r\n### Additional context\r\n\r\n_No response_\n",
  "ground_truth": {
    "files": [
      "sphinx/util/rst.py"
    ],
    "locations": [
      "sphinx/util/rst.py::prepend_prolog"
    ]
  },
  "predictions": [
    "tests/test_domain_rst.py::test_rst_directive",
    "tests/test_domain_rst.py::test_rst_directive_with_argument",
    "tests/test_markup.py::test_rst_prolog",
    "tests/test_directive_only.py::test_sectioning",
    "tests/test_util_rst.py::test_prepend_prolog",
    "tests/test_directive_other.py::test_toctree_urls_and_titles",
    "tests/test_util_rst.py::test_prepend_prolog_without_CR",
    "tests/test_domain_rst.py::test_rst_directive_and_directive_option",
    "tests/test_directive_other.py::test_toctree",
    "tests/test_directive_other.py::test_reversed_toctree"
  ],
  "metadata": {
    "repo": "sphinx-doc/sphinx",
    "commit": "71db08c05197545944949d5aa76cd340e7143627",
    "total_functions_indexed": 5752,
    "retrieval_time_seconds": 0.0012369155883789062
  },
  "raw_output": "[{\"doc_id\": \"tests/test_domain_rst.py::test_rst_directive\", \"score\": 0.4979158341884613}, {\"doc_id\": \"tests/test_domain_rst.py::test_rst_directive_with_argument\", \"score\": 0.44940632581710815}, {\"doc_id\": \"tests/test_markup.py::test_rst_prolog\", \"score\": 0.4445963203907013}, {\"doc_id\": \"tests/test_directive_only.py::test_sectioning\", \"score\": 0.4267177879810333}, {\"doc_id\": \"tests/test_util_rst.py::test_prepend_prolog\", \"score\": 0.4262436032295227}, {\"doc_id\": \"tests/test_directive_other.py::test_toctree_urls_and_titles\", \"score\": 0.42161232233047485}, {\"doc_id\": \"tests/test_util_rst.py::test_prepend_prolog_without_CR\", \"score\": 0.4165073037147522}, {\"doc_id\": \"tests/test_domain_rst.py::test_rst_directive_and_directive_option\", \"score\": 0.4058794379234314}, {\"doc_id\": \"tests/test_directive_other.py::test_toctree\", \"score\": 0.4014394283294678}, {\"doc_id\": \"tests/test_directive_other.py::test_reversed_toctree\", \"score\": 0.4006485939025879}]"
}