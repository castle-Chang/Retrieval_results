{
  "instance_id": "django__django-15930",
  "query": "Case() crashes with ~Q(pk__in=[]).\nDescription\n\t\nThe following code generates a syntax error. \nUser.objects.annotate(\n\t_a=Case(\n\t\tWhen(~Q(pk__in=[]), then=Value(True)),\n\t\tdefault=Value(False),\n\t\toutput_field=BooleanField(),\n\t)\n).order_by(\"-a\").values(\"pk\")\nThe error is: \nProgrammingError: syntax error at or near \"THEN\"\nLINE 1: ..._user\".\"id\" FROM \"users_user\" ORDER BY CASE WHEN THEN true ...\nThe generated SQL is: \nSELECT \"users_user\".\"id\" FROM \"users_user\" ORDER BY CASE WHEN THEN True ELSE False END ASC\nI expected behavior to annotate all rows with the value True since they all match.\nRelevant because ~Q(pkin=[]) is a sentinel value that is sometimes returned by application code.\n",
  "ground_truth": {
    "files": [
      "django/db/models/expressions.py"
    ],
    "locations": [
      "django/db/models/expressions.py::When",
      "django/db/models/expressions.py::When.as_sql"
    ]
  },
  "predictions": [
    "tests/expressions_case/tests.py::CaseExpressionTests.test_case_reuse",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_empty_when",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_combined_q_object",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_in_clause",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_in_subquery",
    "tests/expressions_case/tests.py::CaseWhenTests.test_only_when_arguments",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_aggregation_in_condition",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_values_not_in_order_by",
    "tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_annotation_in_condition"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "63884829acd207404f2a5c3cc1d6b4cd0a822b70",
    "total_functions_indexed": 26095,
    "retrieval_time_seconds": 0.009077787399291992
  },
  "raw_output": "[{\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_case_reuse\", \"score\": 0.5087652206420898}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_empty_when\", \"score\": 0.48765257000923157}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_combined_q_object\", \"score\": 0.48375529050827026}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_in_clause\", \"score\": 0.4835352301597595}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_in_subquery\", \"score\": 0.4795306324958801}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseWhenTests.test_only_when_arguments\", \"score\": 0.471583753824234}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate\", \"score\": 0.46837636828422546}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_aggregation_in_condition\", \"score\": 0.4680485129356384}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_values_not_in_order_by\", \"score\": 0.4675615429878235}, {\"doc_id\": \"tests/expressions_case/tests.py::CaseExpressionTests.test_annotate_with_annotation_in_condition\", \"score\": 0.4665294885635376}]"
}