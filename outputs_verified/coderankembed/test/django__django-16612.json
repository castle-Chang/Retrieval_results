{
  "instance_id": "django__django-16612",
  "query": "AdminSite.catch_all_view() drops query string in redirects\nDescription\n\t\n#31747 introduced AdminSite.catch_all_view(). However, in the process it broke the ability to redirect with settings.APPEND_SLASH = True when there are query strings.\nProvided URL: ​http://127.0.0.1:8000/admin/auth/foo?id=123\nExpected redirect: ​http://127.0.0.1:8000/admin/auth/foo/?id=123\nActual redirect: ​http://127.0.0.1:8000/admin/auth/foo/\nThis seems to be because the redirect in question does not include the query strings (such as via request.META['QUERY_STRING']):\nreturn HttpResponsePermanentRedirect(\"%s/\" % request.path)\n​https://github.com/django/django/blob/c57ff9ba5e251cd4c2761105a6046662c08f951e/django/contrib/admin/sites.py#L456\n",
  "ground_truth": {
    "files": [
      "django/contrib/admin/sites.py"
    ],
    "locations": [
      "django/contrib/admin/sites.py::AdminSite",
      "django/contrib/admin/sites.py::AdminSite.catch_all_view",
      "django/contrib/admin/sites.py::AdminSite._build_app_dict"
    ]
  },
  "predictions": [
    "django/contrib/admin/sites.py::AdminSite.catch_all_view",
    "tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_missing_slash_append_slash_true_without_final_catch_all_view",
    "tests/redirects_tests/tests.py::RedirectTests.test_redirect_with_append_slash_and_query_string",
    "tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_known_url_missing_slash_redirects_with_slash_if_not_auth_no_catch_all_view",
    "tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_url_no_trailing_slash_if_not_auth_without_final_catch_all_view",
    "tests/generic_views/test_base.py::RedirectViewTest.test_redirect_when_meta_contains_no_query_string",
    "tests/middleware/tests.py::CommonMiddlewareTest.test_append_slash_redirect_querystring",
    "tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_unknown_url_no_trailing_slash_if_not_auth_without_final_catch_all_view",
    "tests/test_client/views.py::double_redirect_view",
    "tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_missing_slash_append_slash_false_without_final_catch_all_view"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "55bcbd8d172b689811fae17cde2f09218dd74e9c",
    "total_functions_indexed": 26417,
    "retrieval_time_seconds": 0.008779287338256836
  },
  "raw_output": "[{\"doc_id\": \"django/contrib/admin/sites.py::AdminSite.catch_all_view\", \"score\": 0.6772257685661316}, {\"doc_id\": \"tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_missing_slash_append_slash_true_without_final_catch_all_view\", \"score\": 0.48412832617759705}, {\"doc_id\": \"tests/redirects_tests/tests.py::RedirectTests.test_redirect_with_append_slash_and_query_string\", \"score\": 0.4779547452926636}, {\"doc_id\": \"tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_known_url_missing_slash_redirects_with_slash_if_not_auth_no_catch_all_view\", \"score\": 0.4760541319847107}, {\"doc_id\": \"tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_url_no_trailing_slash_if_not_auth_without_final_catch_all_view\", \"score\": 0.4648768901824951}, {\"doc_id\": \"tests/generic_views/test_base.py::RedirectViewTest.test_redirect_when_meta_contains_no_query_string\", \"score\": 0.4590565860271454}, {\"doc_id\": \"tests/middleware/tests.py::CommonMiddlewareTest.test_append_slash_redirect_querystring\", \"score\": 0.45113515853881836}, {\"doc_id\": \"tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_unknown_url_no_trailing_slash_if_not_auth_without_final_catch_all_view\", \"score\": 0.4435611367225647}, {\"doc_id\": \"tests/test_client/views.py::double_redirect_view\", \"score\": 0.43747466802597046}, {\"doc_id\": \"tests/admin_views/tests.py::AdminSiteFinalCatchAllPatternTests.test_missing_slash_append_slash_false_without_final_catch_all_view\", \"score\": 0.4337708353996277}]"
}