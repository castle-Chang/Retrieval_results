{
  "instance_id": "scikit-learn__scikit-learn-13142",
  "query": "GaussianMixture predict and fit_predict disagree when n_init>1\n#### Description\r\nWhen `n_init` is specified in GaussianMixture, the results of fit_predict(X) and predict(X) are often different.  The `test_gaussian_mixture_fit_predict` unit test doesn't catch this because it does not set `n_init`.\r\n\r\n#### Steps/Code to Reproduce\r\n```\r\npython\r\nfrom sklearn.mixture import GaussianMixture\r\nfrom sklearn.utils.testing import assert_array_equal\r\nimport numpy\r\nX = numpy.random.randn(1000,5)\r\nprint 'no n_init'\r\ngm = GaussianMixture(n_components=5)\r\nc1 = gm.fit_predict(X)\r\nc2 = gm.predict(X)\r\nassert_array_equal(c1,c2)\r\nprint 'n_init=5'\r\ngm = GaussianMixture(n_components=5, n_init=5)\r\nc1 = gm.fit_predict(X)\r\nc2 = gm.predict(X)\r\nassert_array_equal(c1,c2)\r\n```\r\n\r\n#### Expected Results\r\n```\r\nno n_init\r\nn_init=5\r\n```\r\nNo exceptions.\r\n\r\n#### Actual Results\r\n```\r\nno n_init\r\nn_init=5\r\nTraceback (most recent call last):\r\n  File \"test_gm.py\", line 17, in <module>\r\n    assert_array_equal(c1,c2)\r\n  File \"/home/scott/.local/lib/python2.7/site-packages/numpy/testing/_private/utils.py\", line 872, in assert_array_equal\r\n    verbose=verbose, header='Arrays are not equal')\r\n  File \"/home/scott/.local/lib/python2.7/site-packages/numpy/testing/_private/utils.py\", line 796, in assert_array_compare\r\n    raise AssertionError(msg)\r\nAssertionError: \r\nArrays are not equal\r\n\r\n(mismatch 88.6%)\r\n x: array([4, 0, 1, 1, 1, 3, 3, 4, 4, 2, 0, 0, 1, 2, 0, 2, 0, 1, 3, 1, 1, 3,\r\n       2, 1, 0, 2, 1, 0, 2, 0, 3, 1, 2, 3, 3, 1, 0, 2, 2, 0, 3, 0, 2, 0,\r\n       4, 2, 3, 0, 4, 2, 4, 1, 0, 2, 2, 1, 3, 2, 1, 4, 0, 2, 2, 1, 1, 2,...\r\n y: array([4, 1, 0, 2, 2, 1, 1, 4, 4, 0, 4, 1, 0, 3, 1, 0, 2, 2, 1, 2, 0, 0,\r\n       1, 0, 4, 1, 0, 4, 0, 1, 1, 2, 3, 1, 4, 0, 1, 4, 4, 4, 0, 1, 0, 2,\r\n       4, 1, 1, 2, 4, 3, 4, 0, 2, 3, 2, 3, 0, 0, 2, 3, 3, 3, 3, 0, 3, 2,...\r\n```\r\n\r\n#### Versions\r\n```\r\nSystem:\r\n    python: 2.7.15rc1 (default, Nov 12 2018, 14:31:15)  [GCC 7.3.0]\r\n   machine: Linux-4.15.0-43-generic-x86_64-with-Ubuntu-18.04-bionic\r\nexecutable: /usr/bin/python\r\n\r\nBLAS:\r\n    macros: HAVE_CBLAS=None, NO_ATLAS_INFO=-1\r\ncblas_libs: cblas\r\n  lib_dirs: /usr/lib/x86_64-linux-gnu\r\n\r\nPython deps:\r\n    Cython: 0.28.5\r\n     scipy: 1.2.0\r\nsetuptools: 39.0.1\r\n       pip: 19.0.1\r\n     numpy: 1.16.0\r\n    pandas: 0.23.1\r\n   sklearn: 0.20.2\r\n```\n",
  "ground_truth": {
    "files": [
      "sklearn/mixture/base.py"
    ],
    "locations": [
      "sklearn/mixture/base.py::BaseMixture",
      "sklearn/mixture/base.py::BaseMixture.fit_predict",
      "sklearn/mixture/base.py::BaseMixture._e_step"
    ]
  },
  "predictions": [
    "sklearn/cluster/tests/test_mean_shift.py::test_cluster_intensity_tie",
    "sklearn/covariance/tests/test_robust_covariance.py::test_mcd_increasing_det_warning",
    "sklearn/tree/tests/test_tree.py::test_mae",
    "sklearn/model_selection/tests/test_validation.py::test_learning_curve_with_shuffle",
    "sklearn/manifold/tests/test_mds.py::test_smacof_error",
    "sklearn/metrics/cluster/tests/test_unsupervised.py::test_davies_bouldin_score",
    "sklearn/tests/test_naive_bayes.py::test_gnb_priors_sum_isclose",
    "sklearn/model_selection/tests/test_split.py::test_repeated_stratified_kfold_determinstic_split",
    "sklearn/utils/tests/test_extmath.py::test_cartesian",
    "sklearn/metrics/cluster/tests/test_unsupervised.py::test_calinski_harabasz_score"
  ],
  "metadata": {
    "repo": "scikit-learn/scikit-learn",
    "commit": "1c8668b0a021832386470ddf740d834e02c66f69",
    "total_functions_indexed": 6697,
    "retrieval_time_seconds": 1.2838919162750244
  },
  "raw_output": "[{\"doc_id\": \"sklearn/cluster/tests/test_mean_shift.py::test_cluster_intensity_tie\", \"score\": 523.3072497359234}, {\"doc_id\": \"sklearn/covariance/tests/test_robust_covariance.py::test_mcd_increasing_det_warning\", \"score\": 441.4352397367764}, {\"doc_id\": \"sklearn/tree/tests/test_tree.py::test_mae\", \"score\": 440.84458954353863}, {\"doc_id\": \"sklearn/model_selection/tests/test_validation.py::test_learning_curve_with_shuffle\", \"score\": 421.04528482412513}, {\"doc_id\": \"sklearn/manifold/tests/test_mds.py::test_smacof_error\", \"score\": 419.80823215149627}, {\"doc_id\": \"sklearn/metrics/cluster/tests/test_unsupervised.py::test_davies_bouldin_score\", \"score\": 414.7331545783016}, {\"doc_id\": \"sklearn/tests/test_naive_bayes.py::test_gnb_priors_sum_isclose\", \"score\": 406.22176958531054}, {\"doc_id\": \"sklearn/model_selection/tests/test_split.py::test_repeated_stratified_kfold_determinstic_split\", \"score\": 404.9073858206148}, {\"doc_id\": \"sklearn/utils/tests/test_extmath.py::test_cartesian\", \"score\": 403.6383714403791}, {\"doc_id\": \"sklearn/metrics/cluster/tests/test_unsupervised.py::test_calinski_harabasz_score\", \"score\": 402.96393804711505}]"
}