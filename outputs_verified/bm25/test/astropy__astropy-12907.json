{
  "instance_id": "astropy__astropy-12907",
  "query": "Modeling's `separability_matrix` does not compute separability correctly for nested CompoundModels\nConsider the following model:\r\n\r\n```python\r\nfrom astropy.modeling import models as m\r\nfrom astropy.modeling.separable import separability_matrix\r\n\r\ncm = m.Linear1D(10) & m.Linear1D(5)\r\n```\r\n\r\nIt's separability matrix as you might expect is a diagonal:\r\n\r\n```python\r\n>>> separability_matrix(cm)\r\narray([[ True, False],\r\n       [False,  True]])\r\n```\r\n\r\nIf I make the model more complex:\r\n```python\r\n>>> separability_matrix(m.Pix2Sky_TAN() & m.Linear1D(10) & m.Linear1D(5))\r\narray([[ True,  True, False, False],\r\n       [ True,  True, False, False],\r\n       [False, False,  True, False],\r\n       [False, False, False,  True]])\r\n```\r\n\r\nThe output matrix is again, as expected, the outputs and inputs to the linear models are separable and independent of each other.\r\n\r\nIf however, I nest these compound models:\r\n```python\r\n>>> separability_matrix(m.Pix2Sky_TAN() & cm)\r\narray([[ True,  True, False, False],\r\n       [ True,  True, False, False],\r\n       [False, False,  True,  True],\r\n       [False, False,  True,  True]])\r\n```\r\nSuddenly the inputs and outputs are no longer separable?\r\n\r\nThis feels like a bug to me, but I might be missing something?\n",
  "ground_truth": {
    "files": [
      "astropy/modeling/separable.py"
    ],
    "locations": [
      "astropy/modeling/separable.py::_cstack"
    ]
  },
  "predictions": [
    "astropy/modeling/separable.py::separability_matrix",
    "astropy/modeling/separable.py::is_separable",
    "astropy/modeling/tests/test_models_quantities.py::test_models_bounding_box",
    "astropy/modeling/tests/test_core.py::test_custom_model_n_outputs",
    "astropy/units/tests/test_quantity_non_ufuncs.py::TestSettingParts.test_place",
    "astropy/utils/masked/tests/test_table.py::TestMaskedQuantityTable.test_table_operations_requiring_masking",
    "astropy/wcs/tests/test_utils.py::test_pixel_to_pixel_correlation_matrix_nonsquare",
    "astropy/units/tests/test_quantity_non_ufuncs.py::TestSettingParts.test_copyto",
    "astropy/extern/configobj/configobj.py::Section.as_bool",
    "astropy/modeling/tests/test_constraints.py::test_default_constraints"
  ],
  "metadata": {
    "repo": "astropy/astropy",
    "commit": "d16bfe05a744909de4b27f5875fe0d4ed41ce607",
    "total_functions_indexed": 14860,
    "retrieval_time_seconds": 1.5139305591583252
  },
  "raw_output": "[{\"doc_id\": \"astropy/modeling/separable.py::separability_matrix\", \"score\": 337.6134862081117}, {\"doc_id\": \"astropy/modeling/separable.py::is_separable\", \"score\": 254.30209036687512}, {\"doc_id\": \"astropy/modeling/tests/test_models_quantities.py::test_models_bounding_box\", \"score\": 202.59360093442893}, {\"doc_id\": \"astropy/modeling/tests/test_core.py::test_custom_model_n_outputs\", \"score\": 195.65663548189283}, {\"doc_id\": \"astropy/units/tests/test_quantity_non_ufuncs.py::TestSettingParts.test_place\", \"score\": 191.20779088310007}, {\"doc_id\": \"astropy/utils/masked/tests/test_table.py::TestMaskedQuantityTable.test_table_operations_requiring_masking\", \"score\": 190.34254442744754}, {\"doc_id\": \"astropy/wcs/tests/test_utils.py::test_pixel_to_pixel_correlation_matrix_nonsquare\", \"score\": 189.80413512883274}, {\"doc_id\": \"astropy/units/tests/test_quantity_non_ufuncs.py::TestSettingParts.test_copyto\", \"score\": 188.59785206405178}, {\"doc_id\": \"astropy/extern/configobj/configobj.py::Section.as_bool\", \"score\": 188.54355113683496}, {\"doc_id\": \"astropy/modeling/tests/test_constraints.py::test_default_constraints\", \"score\": 187.23318389961787}]"
}