{
  "instance_id": "django__django-13786",
  "query": "squashmigrations does not unset model options when optimizing CreateModel and AlterModelOptions\nDescription\n\t\nWhen an operation resembling AlterModelOptions(name=\"test_model\", options={}) is squashed into the corresponding CreateModel operation, model options are not cleared on the resulting new CreateModel operation object.\nCreateModel.reduce() sets the new options as options={**self.options, **operation.options} in this case (django/db/migrations/operations/models.py line 144 on commit 991dce4f), with no logic to remove options not found in operation.options as is found in AlterModelOptions.state_forwards().\nI believe this issue still exists on the master branch based on my reading of the code, but I've only tested against 2.2.\n",
  "ground_truth": {
    "files": [
      "django/db/migrations/operations/models.py"
    ],
    "locations": [
      "django/db/migrations/operations/models.py::CreateModel",
      "django/db/migrations/operations/models.py::CreateModel.reduce"
    ]
  },
  "predictions": [
    "tests/migrations/test_operations.py::OperationTests.test_alter_model_options_emptying",
    "tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_optimizes",
    "tests/migrations/test_operations.py::OperationTests.test_alter_model_options",
    "tests/migrations/test_commands.py::SquashMigrationsTests.test_ticket_23799_squashmigrations_no_optimize",
    "tests/migrations/test_optimizer.py::OptimizerTests.test_create_alter_model_options",
    "django/core/management/commands/squashmigrations.py::Command.handle",
    "django/db/migrations/operations/models.py::AlterModelOptions.state_forwards",
    "tests/migrations/test_optimizer.py::OptimizerTests._test_create_alter_foo_field",
    "tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_squashes",
    "tests/migrations/test_autodetector.py::AutodetectorTests.test_alter_model_options"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "bb64b99b78a579cb2f6178011a4cf9366e634438",
    "total_functions_indexed": 24230,
    "retrieval_time_seconds": 0.006364345550537109
  },
  "raw_output": "[{\"doc_id\": \"tests/migrations/test_operations.py::OperationTests.test_alter_model_options_emptying\", \"score\": 0.553106963634491}, {\"doc_id\": \"tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_optimizes\", \"score\": 0.5327510833740234}, {\"doc_id\": \"tests/migrations/test_operations.py::OperationTests.test_alter_model_options\", \"score\": 0.5282784700393677}, {\"doc_id\": \"tests/migrations/test_commands.py::SquashMigrationsTests.test_ticket_23799_squashmigrations_no_optimize\", \"score\": 0.521060585975647}, {\"doc_id\": \"tests/migrations/test_optimizer.py::OptimizerTests.test_create_alter_model_options\", \"score\": 0.46287304162979126}, {\"doc_id\": \"django/core/management/commands/squashmigrations.py::Command.handle\", \"score\": 0.4571630358695984}, {\"doc_id\": \"django/db/migrations/operations/models.py::AlterModelOptions.state_forwards\", \"score\": 0.4503443241119385}, {\"doc_id\": \"tests/migrations/test_optimizer.py::OptimizerTests._test_create_alter_foo_field\", \"score\": 0.44227099418640137}, {\"doc_id\": \"tests/migrations/test_commands.py::SquashMigrationsTests.test_squashmigrations_squashes\", \"score\": 0.43393194675445557}, {\"doc_id\": \"tests/migrations/test_autodetector.py::AutodetectorTests.test_alter_model_options\", \"score\": 0.4327313303947449}]"
}