{
  "instance_id": "django__django-14915",
  "query": "ModelChoiceIteratorValue is not hashable.\nDescription\n\t\nRecently I migrated from Django 3.0 to Django 3.1. In my code, I add custom data-* attributes to the select widget options. After the upgrade some of those options broke. Error is {TypeError}unhashable type: 'ModelChoiceIteratorValue'.\nExample (this one breaks):\n\tdef create_option(self, name, value, label, selected, index, subindex=None, attrs=None):\n\t\tcontext = super().create_option(name, value, label, selected, index, subindex, attrs)\n\t\tif not value:\n\t\t\treturn context\n\t\tif value in self.show_fields: # This is a dict {1: ['first_name', 'last_name']}\n\t\t\tcontext['attrs']['data-fields'] = json.dumps(self.show_fields[value])\nHowever, working with arrays is not an issue:\n\tdef create_option(self, name, value, label, selected, index, subindex=None, attrs=None):\n\t\tcontext = super().create_option(name, value, label, selected, index, subindex, attrs)\n\t\tif not value:\n\t\t\treturn context\n\t\tif value in allowed_values: # This is an array [1, 2]\n\t\t\t...\n",
  "ground_truth": {
    "files": [
      "django/forms/models.py"
    ],
    "locations": [
      "django/forms/models.py::ModelChoiceIteratorValue",
      "django/forms/models.py::ModelChoiceIteratorValue.__str__",
      "django/forms/models.py::ModelChoiceIteratorValue.__eq__"
    ]
  },
  "predictions": [
    "django/forms/models.py::ModelChoiceIteratorValue.__init__",
    "django/forms/models.py::ModelChoiceIterator.choice",
    "django/forms/models.py::ModelChoiceIteratorValue.__eq__",
    "django/forms/models.py::ModelChoiceIteratorValue.__str__",
    "django/forms/models.py::ModelChoiceField.has_changed",
    "django/contrib/admin/widgets.py::AutocompleteMixin.optgroups",
    "django/forms/models.py::ModelMultipleChoiceField.has_changed",
    "tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_custom_choice_iterator_passes_model_to_widget",
    "django/forms/widgets.py::ChoiceWidget.get_context",
    "django/forms/models.py::ModelChoiceIterator.__init__"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "903aaa35e5ceaa33bfc9b19b7f6da65ce5a91dd4",
    "total_functions_indexed": 25127,
    "retrieval_time_seconds": 0.10260868072509766
  },
  "raw_output": "[{\"doc_id\": \"django/forms/models.py::ModelChoiceIteratorValue.__init__\", \"score\": 0.5480196475982666}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIterator.choice\", \"score\": 0.5155215859413147}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIteratorValue.__eq__\", \"score\": 0.4972470998764038}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIteratorValue.__str__\", \"score\": 0.4896736741065979}, {\"doc_id\": \"django/forms/models.py::ModelChoiceField.has_changed\", \"score\": 0.4577280282974243}, {\"doc_id\": \"django/contrib/admin/widgets.py::AutocompleteMixin.optgroups\", \"score\": 0.4449654817581177}, {\"doc_id\": \"django/forms/models.py::ModelMultipleChoiceField.has_changed\", \"score\": 0.4348324239253998}, {\"doc_id\": \"tests/model_forms/test_modelchoicefield.py::ModelChoiceFieldTests.test_custom_choice_iterator_passes_model_to_widget\", \"score\": 0.4272218942642212}, {\"doc_id\": \"django/forms/widgets.py::ChoiceWidget.get_context\", \"score\": 0.4231840968132019}, {\"doc_id\": \"django/forms/models.py::ModelChoiceIterator.__init__\", \"score\": 0.41995394229888916}]"
}