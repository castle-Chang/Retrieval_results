{
  "instance_id": "django__django-14580",
  "query": "Missing import statement in generated migration (NameError: name 'models' is not defined)\nDescription\n\t\nI found a bug in Django's latest release: 3.2.4. \nGiven the following contents of models.py:\nfrom django.db import models\nclass MyField(models.TextField):\n\tpass\nclass MyBaseModel(models.Model):\n\tclass Meta:\n\t\tabstract = True\nclass MyMixin:\n\tpass\nclass MyModel(MyMixin, MyBaseModel):\n\tname = MyField(primary_key=True)\nThe makemigrations command will generate the following migration file:\n# Generated by Django 3.2.4 on 2021-06-30 19:13\nimport app.models\nfrom django.db import migrations\nclass Migration(migrations.Migration):\n\tinitial = True\n\tdependencies = [\n\t]\n\toperations = [\n\t\tmigrations.CreateModel(\n\t\t\tname='MyModel',\n\t\t\tfields=[\n\t\t\t\t('name', app.models.MyField(primary_key=True, serialize=False)),\n\t\t\t],\n\t\t\toptions={\n\t\t\t\t'abstract': False,\n\t\t\t},\n\t\t\tbases=(app.models.MyMixin, models.Model),\n\t\t),\n\t]\nWhich will then fail with the following error:\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 7, in <module>\n\tclass Migration(migrations.Migration):\n File \"/home/jj/django_example/app/migrations/0001_initial.py\", line 23, in Migration\n\tbases=(app.models.MyMixin, models.Model),\nNameError: name 'models' is not defined\nExpected behavior: Django generates a migration file that is valid Python.\nActual behavior: Django generates a migration file that is missing an import statement.\nI think this is a bug of the module django.db.migrations.writer, but I'm not sure. I will be happy to assist with debugging.\nThanks for your attention,\nJaap Joris\n",
  "ground_truth": {
    "files": [
      "django/db/migrations/serializer.py"
    ],
    "locations": [
      "django/db/migrations/serializer.py::TypeSerializer",
      "django/db/migrations/serializer.py::TypeSerializer.serialize"
    ]
  },
  "predictions": [
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_files_content",
    "tests/migrations/test_writer.py::WriterTests.test_models_import_omitted",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_empty_migration",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_no_init",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_path_not_exist",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_disabled_migrations_for_app",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_no_apps_initial",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migration_path_output_valueerror",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_failing_migration",
    "tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_nonexistent_toplevel_package"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "36fa071d6ebd18a61c4d7f1b5c9d17106134bd44",
    "total_functions_indexed": 24708,
    "retrieval_time_seconds": 0.008799076080322266
  },
  "raw_output": "[{\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_files_content\", \"score\": 0.588253378868103}, {\"doc_id\": \"tests/migrations/test_writer.py::WriterTests.test_models_import_omitted\", \"score\": 0.5742689371109009}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_empty_migration\", \"score\": 0.5660233497619629}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_no_init\", \"score\": 0.5628154277801514}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_path_not_exist\", \"score\": 0.5531744956970215}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_disabled_migrations_for_app\", \"score\": 0.5483189821243286}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_no_apps_initial\", \"score\": 0.541529655456543}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migration_path_output_valueerror\", \"score\": 0.5370986461639404}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_failing_migration\", \"score\": 0.531898558139801}, {\"doc_id\": \"tests/migrations/test_commands.py::MakeMigrationsTests.test_makemigrations_migrations_modules_nonexistent_toplevel_package\", \"score\": 0.5257545113563538}]"
}