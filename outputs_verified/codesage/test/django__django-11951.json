{
  "instance_id": "django__django-11951",
  "query": "bulk_create batch_size param overrides the compatible batch size calculation\nDescription\n\t \n\t\t(last modified by Ahmet Kucuk)\n\t \nAt this line: ​https://github.com/django/django/blob/stable/2.2.x/django/db/models/query.py#L1197\nbatch_size param overrides compatible batch size calculation. This looks like a bug as bulk_update properly picks the minimum of two:\n​https://github.com/django/django/blob/stable/2.2.x/django/db/models/query.py#L504\nI suggest using similar\n batch_size = min(batch_size, max_batch_size) if batch_size else max_batch_size\nlogic in bulk_create as well. I am happy to open a PR for it.\n",
  "ground_truth": {
    "files": [
      "django/db/models/query.py"
    ],
    "locations": [
      "django/db/models/query.py::QuerySet",
      "django/db/models/query.py::QuerySet._batched_insert"
    ]
  },
  "predictions": [
    "django/db/backends/base/operations.py::BaseDatabaseOperations.bulk_batch_size",
    "tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size_efficiency",
    "tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size",
    "django/db/backends/oracle/operations.py::DatabaseOperations.bulk_batch_size",
    "tests/backends/oracle/test_operations.py::OperationsTests.test_bulk_batch_size",
    "tests/bulk_create/tests.py::BulkCreateTests.test_large_batch_efficiency",
    "tests/queries/test_bulk_update.py::BulkUpdateTests.test_invalid_batch_size",
    "tests/bulk_create/tests.py::BulkCreateTests.test_large_batch",
    "tests/bulk_create/tests.py::BulkCreateTests.test_large_batch_mixed",
    "django/db/backends/sqlite3/operations.py::DatabaseOperations.bulk_batch_size"
  ],
  "metadata": {
    "repo": "django/django",
    "commit": "312049091288dbba2299de8d07ea3e3311ed7238",
    "total_functions_indexed": 22905,
    "retrieval_time_seconds": 0.09516263008117676
  },
  "raw_output": "[{\"doc_id\": \"django/db/backends/base/operations.py::BaseDatabaseOperations.bulk_batch_size\", \"score\": 0.43613964319229126}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size_efficiency\", \"score\": 0.4190599322319031}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_explicit_batch_size\", \"score\": 0.4123663902282715}, {\"doc_id\": \"django/db/backends/oracle/operations.py::DatabaseOperations.bulk_batch_size\", \"score\": 0.3793438971042633}, {\"doc_id\": \"tests/backends/oracle/test_operations.py::OperationsTests.test_bulk_batch_size\", \"score\": 0.37571293115615845}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_large_batch_efficiency\", \"score\": 0.36891305446624756}, {\"doc_id\": \"tests/queries/test_bulk_update.py::BulkUpdateTests.test_invalid_batch_size\", \"score\": 0.366916686296463}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_large_batch\", \"score\": 0.36240845918655396}, {\"doc_id\": \"tests/bulk_create/tests.py::BulkCreateTests.test_large_batch_mixed\", \"score\": 0.35896626114845276}, {\"doc_id\": \"django/db/backends/sqlite3/operations.py::DatabaseOperations.bulk_batch_size\", \"score\": 0.34395718574523926}]"
}